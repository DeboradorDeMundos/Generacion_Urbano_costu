---
import Nav from './Nav.astro';

export interface Props {
  transparent?: boolean;
}

const { transparent = false } = Astro.props;
---

<header class:list={[
  'fixed top-0 z-50 w-full transition-all duration-500 ease-in-out',
  { 'bg-white/90 backdrop-blur-lg border-b border-gray-200/50 shadow-lg': !transparent },
  { 'bg-transparent': transparent }
]} id="main-header">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 lg:h-20 items-center justify-between transition-all duration-300" id="header-content">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="group flex items-center space-x-3 transition-all duration-300 hover:scale-105">
          <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-lg blur opacity-20 group-hover:opacity-40 transition-opacity duration-300"></div>
            <div class="relative w-10 h-10 lg:w-12 lg:h-12 bg-gradient-to-r from-primary-600 to-secondary-500 rounded-lg flex items-center justify-center transition-all duration-300" id="logo-container">
              <span class="text-white font-bold text-lg lg:text-xl" id="logo-text">GU</span>
            </div>
          </div>
          <div class="hidden sm:block">
            <div class="text-lg lg:text-xl font-bold text-gray-900 group-hover:text-primary-600 transition-all duration-300" id="brand-text">
              Generación Urbana
            </div>
            <div class="text-xs text-gray-500 -mt-1 transition-all duration-300" id="tagline">
              Costura • San Bernardo
            </div>
          </div>
        </a>
      </div>

      <!-- Navigation -->
      <Nav />

      <!-- CTA Button -->
      <div class="hidden lg:flex items-center space-x-4">
        <a 
          href="tel:+56912345678" 
          class="text-primary-600 hover:text-primary-700 font-medium text-sm transition-colors"
        >
          +56 9 1234 5678
        </a>
        <a
          href="/contacto"
          class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold rounded-xl hover:from-primary-700 hover:to-primary-800 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 duration-200"
        >
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          Cotizar
        </a>
      </div>

      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button
          type="button"
          class="inline-flex items-center justify-center rounded-xl p-2 text-gray-700 hover:bg-gray-100 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 transition-colors"
          aria-controls="mobile-menu"
          aria-expanded="false"
          id="mobile-menu-button"
        >
          <span class="sr-only">Abrir menú principal</span>
          <!-- Hamburger icon -->
          <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div class="hidden md:hidden bg-white border-t border-gray-100 shadow-lg" id="mobile-menu">
    <div class="px-4 py-6 space-y-4">
      <a href="/productos" class="flex items-center px-4 py-3 text-base font-medium text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-xl transition-colors">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        Productos
      </a>
      <a href="/servicios" class="flex items-center px-4 py-3 text-base font-medium text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-xl transition-colors">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
        </svg>
        Servicios
      </a>
      <a href="/blog" class="flex items-center px-4 py-3 text-base font-medium text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-xl transition-colors">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"></path>
        </svg>
        Blog
      </a>
      <a href="/contacto" class="flex items-center px-4 py-3 text-base font-medium text-gray-700 hover:bg-primary-50 hover:text-primary-600 rounded-xl transition-colors">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        </svg>
        Contacto
      </a>
      
      <!-- Mobile CTA -->
      <div class="pt-4 border-t border-gray-100">
        <a
          href="/contacto"
          class="flex items-center justify-center w-full px-6 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold rounded-xl hover:from-primary-700 hover:to-primary-800 transition-all shadow-lg"
        >
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          Solicitar Cotización
        </a>
        
        <a 
          href="tel:+56912345678" 
          class="flex items-center justify-center w-full mt-3 px-6 py-3 border-2 border-primary-600 text-primary-600 font-medium rounded-xl hover:bg-primary-50 transition-colors"
        >
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
          </svg>
          +56 9 1234 5678
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const button = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('main-header');
    const headerContent = document.getElementById('header-content');
    const logoContainer = document.getElementById('logo-container');
    const logoText = document.getElementById('logo-text');
    const brandText = document.getElementById('brand-text');
    const tagline = document.getElementById('tagline');
    
    // Mobile menu functionality
    if (button && menu) {
      button.addEventListener('click', () => {
        const expanded = button.getAttribute('aria-expanded') === 'true';
        button.setAttribute('aria-expanded', (!expanded).toString());
        menu.classList.toggle('hidden');
      });
    }
    
    // Enhanced scroll behavior for header
    let lastScrollTop = 0;
    let scrolled = false;
    
    function updateHeader() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const isScrollingDown = scrollTop > lastScrollTop;
      const hasScrolled = scrollTop > 20;
      
      if (header) {
        if (hasScrolled && !scrolled) {
          // Scrolled state - more compact and solid background
          header.classList.remove('bg-transparent');
          header.classList.add('bg-white/95', 'backdrop-blur-xl', 'border-b', 'border-gray-200/60', 'shadow-xl');
          
          // Make header more compact
          if (headerContent) {
            headerContent.classList.remove('h-16', 'lg:h-20');
            headerContent.classList.add('h-14', 'lg:h-16');
          }
          
          // Make logo smaller
          if (logoContainer) {
            logoContainer.classList.remove('w-10', 'h-10', 'lg:w-12', 'lg:h-12');
            logoContainer.classList.add('w-8', 'h-8', 'lg:w-10', 'lg:h-10');
          }
          
          if (logoText) {
            logoText.classList.remove('text-lg', 'lg:text-xl');
            logoText.classList.add('text-base', 'lg:text-lg');
          }
          
          // Make brand text smaller
          if (brandText) {
            brandText.classList.remove('text-lg', 'lg:text-xl');
            brandText.classList.add('text-base', 'lg:text-lg');
          }
          
          // Hide tagline on mobile when scrolled
          if (tagline) {
            tagline.classList.add('hidden', 'lg:block');
          }
          
          scrolled = true;
        } else if (!hasScrolled && scrolled) {
          // Top state - restore original size
          header.classList.add('bg-transparent');
          header.classList.remove('bg-white/95', 'backdrop-blur-xl', 'border-b', 'border-gray-200/60', 'shadow-xl');
          
          // Restore header height
          if (headerContent) {
            headerContent.classList.remove('h-14', 'lg:h-16');
            headerContent.classList.add('h-16', 'lg:h-20');
          }
          
          // Restore logo size
          if (logoContainer) {
            logoContainer.classList.remove('w-8', 'h-8', 'lg:w-10', 'lg:h-10');
            logoContainer.classList.add('w-10', 'h-10', 'lg:w-12', 'lg:h-12');
          }
          
          if (logoText) {
            logoText.classList.remove('text-base', 'lg:text-lg');
            logoText.classList.add('text-lg', 'lg:text-xl');
          }
          
          // Restore brand text size
          if (brandText) {
            brandText.classList.remove('text-base', 'lg:text-lg');
            brandText.classList.add('text-lg', 'lg:text-xl');
          }
          
          // Show tagline again
          if (tagline) {
            tagline.classList.remove('hidden', 'lg:block');
          }
          
          scrolled = false;
        }
        
        // Hide/show header on scroll (optional - uncomment if you want this behavior)
        /*
        if (isScrollingDown && scrollTop > 200) {
          header.style.transform = 'translateY(-100%)';
        } else {
          header.style.transform = 'translateY(0)';
        }
        */
      }
      
      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    }
    
    // Throttled scroll event
    let ticking = false;
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
        setTimeout(() => { ticking = false; }, 16); // ~60fps
      }
    }
    
    window.addEventListener('scroll', requestTick, { passive: true });
    
    // Initial check
    updateHeader();
    
    // Smooth scroll behavior for navigation
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          const headerHeight = header ? header.offsetHeight : 80;
          const targetPosition = target.offsetTop - headerHeight;
          
          window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
          });
        }
      });
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (menu && button && !menu.contains(e.target) && !button.contains(e.target)) {
        menu.classList.add('hidden');
        button.setAttribute('aria-expanded', 'false');
      }
    });
    
    // Close mobile menu when window is resized to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && menu) {
        menu.classList.add('hidden');
        if (button) button.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>