---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/common/Header.astro";
---

<BaseLayout
  title="Dise√±ador de Polerones - Generaci√≥n Urbano"
  description="Dise√±a y personaliza tu poler√≥n generacional con nuestro configurador interactivo"
>
  <Header />

  <main class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Header del Dise√±ador -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-black text-black mb-2">
          Dise√±ador de <span class="text-red-600">Polerones</span>
        </h1>
        <p class="text-gray-600">
          Personaliza tu poler√≥n, guarda y comparte tu dise√±o
        </p>
      </div>

      <!-- Layout Principal: 3 Columnas -->
      <div class="grid lg:grid-cols-12 gap-8">
        <!-- Columna Izquierda: Controles (Modelos, Color, Imagen) -->
        <div class="lg:col-span-3 space-y-6">
          <!-- Selector de Modelo -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div
              class="flex items-center justify-between mb-4 cursor-pointer panel-header"
            >
              <h3 class="font-bold text-lg text-gray-800">Modelo de Poler√≥n</h3>
              <span class="transform transition-transform duration-200">‚ñΩ</span>
            </div>
            <div class="panel-content">
              <div
                class="flex overflow-x-auto gap-3 pb-2 snap-x snap-mandatory scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"
                style="scrollbar-width: thin;"
              >
                <button
                  class="modelo-btn active flex-shrink-0 snap-center"
                  data-modelo="modelo-1"
                  style="min-width: 120px;"
                >
                  <img
                    src="/images/services/modelo_1/frente/sombra-y-borde.png"
                    alt="Canguro con cierre"
                    class="w-full h-24 object-contain"
                  />
                  <div class="text-xs font-semibold text-center mt-1">
                    Canguro con cierre
                  </div>
                </button>
                <!-- Modelo 2 oculto - no utilizado por el cliente
                <button
                  class="modelo-btn flex-shrink-0 snap-center"
                  data-modelo="modelo-2"
                  style="min-width: 120px; display: none;"
                >
                  <img
                    src="/images/services/modelo_2/frente/sombra-y-borde.png"
                    alt="Modelo 2"
                    class="w-full h-24 object-contain"
                  />
                  <div class="text-xs font-semibold text-center mt-1">
                    Modelo 2
                  </div>
                </button>
                -->
                <button
                  class="modelo-btn flex-shrink-0 snap-center"
                  data-modelo="modelo-3"
                  style="min-width: 120px;"
                >
                  <img
                    src="/images/services/modelo_3/frente/sombra-y-borde.png"
                    alt="Americano b√°sico"
                    class="w-full h-24 object-contain"
                  />
                  <div class="text-xs font-semibold text-center mt-1">
                    Americano b√°sico
                  </div>
                </button>
                <button
                  class="modelo-btn flex-shrink-0 snap-center"
                  data-modelo="modelo-4"
                  style="min-width: 120px;"
                >
                  <img
                    src="/images/services/modelo_4/frente/sombra-y-borde.png"
                    alt="Americano con gorro"
                    class="w-full h-24 object-contain"
                  />
                  <div class="text-xs font-semibold text-center mt-1">
                    Americano con gorro
                  </div>
                </button>
                <button
                  class="modelo-btn flex-shrink-0 snap-center"
                  data-modelo="modelo-5"
                  style="min-width: 120px;"
                >
                  <img
                    src="/images/services/modelo_5/frente/sombra-y-borde.png"
                    alt="Canguro"
                    class="w-full h-24 object-contain"
                  />
                  <div class="text-xs font-semibold text-center mt-1">
                    Canguro
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- Selector de Tipo de Prenda (solo para modelos 3 y 4) -->
          <div
            id="selectorTipoPrenda"
            class="bg-white rounded-xl shadow-lg p-6"
            style="display:none;"
          >
            <div
              class="flex items-center justify-between mb-4 cursor-pointer panel-header"
            >
              <h3 class="font-bold text-lg text-gray-800">Tipo de Prenda</h3>
              <span class="transform transition-transform duration-200">‚ñΩ</span>
            </div>
            <div class="panel-content">
              <div class="grid grid-cols-2 gap-3">
                <button
                  class="tipo-prenda-btn active border-2 border-gray-300 rounded-lg p-4 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-center"
                  data-tipo="poleron"
                >
                  <div class="text-3xl mb-2">üß•</div>
                  <div class="text-sm font-semibold">Poler√≥n</div>
                </button>
                <button
                  class="tipo-prenda-btn border-2 border-gray-300 rounded-lg p-4 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-center"
                  data-tipo="cortaviento"
                >
                  <div class="text-3xl mb-2">üå¨Ô∏è</div>
                  <div class="text-sm font-semibold">Cortaviento</div>
                </button>
              </div>
            </div>
          </div>

          <!-- Selector de Tipo de Cierre (solo para modelos 1, 2, 3 y 4) -->
          <div
            id="selectorTipoCierre"
            class="bg-white rounded-xl shadow-lg p-6"
            style="display:none;"
          >
            <div
              class="flex items-center justify-between mb-4 cursor-pointer panel-header"
            >
              <h3 class="font-bold text-lg text-gray-800">Tipo de Cierre</h3>
              <span class="transform transition-transform duration-200">‚ñΩ</span>
            </div>
            <div class="panel-content">
              <div class="grid grid-cols-2 gap-3">
                <button
                  class="tipo-cierre-btn border-2 border-gray-300 rounded-lg p-4 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-center"
                  data-cierre="solo-cierre"
                >
                  <div class="text-3xl mb-2">ü§ê</div>
                  <div class="text-sm font-semibold">Solo Cierre</div>
                </button>
                <button
                  class="tipo-cierre-btn active border-2 border-gray-300 rounded-lg p-4 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-center"
                  data-cierre="cierre-broche"
                >
                  <div class="text-3xl mb-2">üîò</div>
                  <div class="text-sm font-semibold">Cierre y Broche</div>
                </button>
              </div>
            </div>
          </div>

          <!-- Personalizar Color (Fusionado) -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div
              class="flex items-center justify-between mb-4 cursor-pointer panel-header"
            >
              <h3 class="font-bold text-lg text-gray-800">
                Personalizar Color
              </h3>
              <span class="transform transition-transform duration-200">‚ñΩ</span>
            </div>
            <div class="panel-content space-y-6 hidden">
              <!-- Parte a Pintar -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Parte a Personalizar</label
                >
                <select
                  id="parteSelect"
                  class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none font-semibold"
                >
                  <option value="cuerpo">Cuerpo</option>
                  <option value="mangas">Mangas</option>
                  <option value="cuello">Cuello/Gorro</option>
                  <option value="pu√±os">Pu√±os</option>
                  <option value="cintura">Cintura</option>
                  <option value="bolsillos">Bolsillos</option>
                  <option value="forro">Forro Gorro</option>
                </select>
              </div>

              <!-- Selector de Color -->
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Seleccionar Color</label
                >
                <div class="grid grid-cols-6 gap-2">
                  <!-- Fila 1 -->
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#FFFFFF"
                    title="Blanco"
                    style="background-color: #FFFFFF;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#000000"
                    title="Negro"
                    style="background-color: #000000;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#FF00FF"
                    title="Fuxia"
                    style="background-color: #FF00FF;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#2E5090"
                    title="Calipso"
                    style="background-color: #2E5090;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#318CE7"
                    title="Azul Francia"
                    style="background-color: #318CE7;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#FFFDD0"
                    title="Crema"
                    style="background-color: #FFFDD0;"></button>

                  <!-- Fila 2 -->
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#FFDB58"
                    title="Mostaza"
                    style="background-color: #FFDB58;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#C8A2C8"
                    title="Lila"
                    style="background-color: #C8A2C8;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#E6E6FA"
                    title="Lila/Lavanda"
                    style="background-color: #E6E6FA;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#800080"
                    title="P√∫rpura"
                    style="background-color: #800080;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#9370DB"
                    title="Morado"
                    style="background-color: #9370DB;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#145A32"
                    title="Verde Petr√≥leo"
                    style="background-color: #145A32;"></button>

                  <!-- Fila 3 -->
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#1B4F72"
                    title="Azul Petr√≥leo"
                    style="background-color: #1B4F72;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#D62828"
                    title="Rojo Italiano"
                    style="background-color: #D62828;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#FFC0CB"
                    title="Rosado"
                    style="background-color: #FFC0CB;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#E7B8B8"
                    title="Rosado Palo de Rosa"
                    style="background-color: #E7B8B8;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#F5F5DC"
                    title="Beige"
                    style="background-color: #F5F5DC;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#B0B0B0"
                    title="Gris Melange"
                    style="background-color: #B0B0B0;"></button>

                  <!-- Fila 4 -->
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#4A4A4A"
                    title="Gris Marengo"
                    style="background-color: #4A4A4A;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#88B04B"
                    title="Verde Cata"
                    style="background-color: #88B04B;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#4169E1"
                    title="Azul Rey"
                    style="background-color: #4169E1;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#800020"
                    title="Burdeo"
                    style="background-color: #800020;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#006A4E"
                    title="Verde Botella"
                    style="background-color: #006A4E;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#87CEEB"
                    title="Celeste"
                    style="background-color: #87CEEB;"></button>

                  <!-- Fila 5 -->
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#50C878"
                    title="Verde Turquesa/Esmeralda"
                    style="background-color: #50C878;"></button>
                  <button
                    class="color-preset w-10 h-10 rounded-lg border-2 border-gray-300 hover:border-red-600 transition-colors"
                    data-color="#00A86B"
                    title="Verde Jade"
                    style="background-color: #00A86B;"></button>
                </div>
                <!-- Color Personalizado deshabilitado -->
                <div style="display: none;" class="mt-2">
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Color Personalizado</label
                  >
                  <input
                    type="color"
                    id="colorCustom"
                    class="w-full h-12 rounded-lg cursor-pointer border-2 border-gray-300"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Agregar Imagen/Logo -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div
              class="flex items-center justify-between mb-4 cursor-pointer panel-header"
            >
              <h3 class="font-bold text-lg text-gray-800">
                Agregar Imagen/Texto
              </h3>
              <span class="transform transition-transform duration-200">‚ñΩ</span>
            </div>
            <div class="panel-content hidden">
              <div class="space-y-3">
                <button
                  id="btnAgregarImagen"
                  class="w-full px-4 py-3 bg-black hover:bg-gray-800 text-white font-semibold rounded-lg transition-colors"
                >
                  Subir Imagen
                </button>
                <input
                  type="file"
                  id="inputImagen"
                  accept="image/*"
                  class="hidden"
                />
                <p class="text-xs text-gray-500 text-center">
                  JPG, PNG, SVG (m√°x 5MB)
                </p>
              </div>
              <div class="mt-6 border-t pt-4">
                <h3 class="font-bold text-lg mb-4 text-gray-800">
                  Agregar Texto
                </h3>
                <div class="space-y-3">
                  <div class="relative flex gap-2">
                    <input
                      id="textoInput"
                      type="text"
                      placeholder="Tu texto"
                      class="w-full px-3 py-2 border rounded-lg text-sm"
                    />
                    <button
                      id="btnEmoji"
                      class="px-3 py-2 border rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors"
                      title="Agregar Emoji"
                    >
                      üòä
                    </button>
                    <div
                      id="emojiPickerContainer"
                      class="absolute top-full right-0 mt-2 z-50 hidden shadow-xl rounded-lg overflow-hidden bg-white"
                    >
                      <div id="pickerRoot"></div>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="text-xs font-semibold">Color</label>
                      <input
                        id="textoColor"
                        type="color"
                        value="#000000"
                        class="w-full h-10 border rounded"
                      />
                    </div>
                    <div>
                      <label class="text-xs font-semibold">Tama√±o</label>
                      <input
                        id="textoSize"
                        type="range"
                        min="12"
                        max="72"
                        value="32"
                        class="w-full"
                      />
                    </div>
                  </div>
                  <button
                    id="btnAgregarTexto"
                    class="w-full px-4 py-3 bg-gray-800 hover:bg-gray-700 text-white font-semibold rounded-lg transition-colors"
                    >Agregar Texto</button
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Columna Central: Canvas de Dise√±o (Sticky) -->
        <div class="lg:col-span-6">
          <div class="sticky top-8 bg-white rounded-xl shadow-lg p-6">
            <div class="text-center mb-4">
              <p class="text-sm text-gray-600">
                <span class="font-semibold">Tip:</span> Arrastra elementos entre
                frente y espalda libremente
              </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6" id="canvasUnificado">
              <!-- Vista Frontal -->
              <div
                data-vista-container="frontal"
                class="transition-all duration-300 cursor-pointer"
                id="contenedorFrontal"
              >
                <h3 class="text-center font-bold text-gray-700 mb-4">Frente</h3>
                <div
                  class="bg-gray-100 rounded-lg p-4 flex items-center justify-center hover:bg-gray-200 transition-colors border-4 border-blue-500"
                >
                  <svg
                    id="svgFrontal"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full"
                    style="display:none;"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="watermarkPattern"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <!-- Gradientes 3D HIPERREALISTAS -->
                      <linearGradient
                        id="bodyGradient"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="0%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(0,0,0,0.25);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="15%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="50%"
                          style="stop-color:rgba(255,255,255,0.08);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="85%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.25);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <!-- Gradiente vertical para volumen -->
                      <linearGradient
                        id="bodyGradientVertical"
                        x1="0%"
                        y1="0%"
                        x2="0%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(255,255,255,0.15);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="40%"
                          style="stop-color:rgba(0,0,0,0);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.15);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="sleeveGradient"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="0%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(0,0,0,0.3);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="50%"
                          style="stop-color:rgba(0,0,0,0.1);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(255,255,255,0.12);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="hoodGradientFront"
                        x1="0%"
                        y1="0%"
                        x2="0%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(255,255,255,0.2);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="60%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.3);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="pocketDepth"
                        x1="0%"
                        y1="0%"
                        x2="0%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(0,0,0,0.5);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.1);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <!-- Patr√≥n de textura de tela -->
                      <pattern
                        id="fabricTexture"
                        x="0"
                        y="0"
                        width="4"
                        height="4"
                        patternUnits="userSpaceOnUse"
                      >
                        <rect width="4" height="4" fill="rgba(0,0,0,0.02)"
                        ></rect>
                        <path
                          d="M0,0 L4,4 M4,0 L0,4"
                          stroke="rgba(0,0,0,0.03)"
                          stroke-width="0.5"></path>
                      </pattern>

                      <!-- Patr√≥n de tejido tipo jersey -->
                      <pattern
                        id="jerseyTexture"
                        x="0"
                        y="0"
                        width="6"
                        height="3"
                        patternUnits="userSpaceOnUse"
                      >
                        <ellipse
                          cx="1"
                          cy="1.5"
                          rx="1"
                          ry="0.8"
                          fill="rgba(0,0,0,0.04)"></ellipse>
                        <ellipse
                          cx="4"
                          cy="1.5"
                          rx="1"
                          ry="0.8"
                          fill="rgba(0,0,0,0.04)"></ellipse>
                      </pattern>

                      <!-- Filtros mejorados -->
                      <filter id="softShadow">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"
                        ></feGaussianBlur>
                        <feOffset dx="0" dy="2" result="offsetblur"></feOffset>
                        <feComponentTransfer>
                          <feFuncA type="linear" slope="0.5"></feFuncA>
                        </feComponentTransfer>
                        <feMerge>
                          <feMergeNode></feMergeNode>
                          <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                      </filter>

                      <filter id="innerShadow">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="3"
                        ></feGaussianBlur>
                        <feOffset dx="0" dy="2"></feOffset>
                        <feComposite
                          in2="SourceAlpha"
                          operator="arithmetic"
                          k2="-1"
                          k3="1"></feComposite>
                        <feColorMatrix
                          values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"
                        ></feColorMatrix>
                      </filter>

                      <filter id="deepShadow">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="4"
                        ></feGaussianBlur>
                        <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                        <feComponentTransfer>
                          <feFuncA type="linear" slope="0.7"></feFuncA>
                        </feComponentTransfer>
                        <feMerge>
                          <feMergeNode></feMergeNode>
                          <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                      </filter>
                    </defs>

                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#watermarkPattern)"
                      pointer-events="none"></rect>

                    <!-- Cuerpo principal HIPERREALISTA con forma anat√≥mica y detalles -->
                    <path
                      id="cuerpoFrontal"
                      class="parte-poleron"
                      data-parte="cuerpo"
                      d="M82,88 Q82,86 84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 Q218,86 218,88 L216,85 L180,65 L120,65 L82,85 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadow)"></path>

                    <!-- Textura de tela sobre el cuerpo -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#fabricTexture)"
                      opacity="1"
                      pointer-events="none"></path>

                    <!-- Textura jersey sobre el cuerpo -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#jerseyTexture)"
                      opacity="1"
                      pointer-events="none"></path>

                    <!-- Gradiente volum√©trico horizontal -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#bodyGradient)"
                      opacity="0.6"
                      pointer-events="none"></path>

                    <!-- Gradiente volum√©trico vertical -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#bodyGradientVertical)"
                      opacity="0.5"
                      pointer-events="none"></path>

                    <!-- Sombras laterales profundas con gradiente -->
                    <path
                      d="M84,85 L84,280 Q84,290 86,298"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="15"
                      opacity="0.7"
                      pointer-events="none"></path>
                    <path
                      d="M216,85 L216,280 Q216,290 214,298"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="15"
                      opacity="0.7"
                      pointer-events="none"></path>

                    <!-- Sombras difuminadas costados (segunda capa) -->
                    <path
                      d="M88,90 L88,290"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="10"
                      filter="blur(4px)"
                      pointer-events="none"></path>
                    <path
                      d="M212,90 L212,290"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="10"
                      filter="blur(4px)"
                      pointer-events="none"></path>

                    <!-- Pliegues naturales del torso -->
                    <path
                      d="M95,150 Q100,155 105,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.5"
                      opacity="0.8"
                      pointer-events="none"></path>
                    <path
                      d="M195,150 Q200,155 205,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.5"
                      opacity="0.8"
                      pointer-events="none"></path>
                    <path
                      d="M90,200 Q95,205 100,200"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.5"
                      opacity="0.8"
                      pointer-events="none"></path>
                    <path
                      d="M200,200 Q205,205 210,200"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.5"
                      opacity="0.8"
                      pointer-events="none"></path>

                    <!-- Highlight central (efecto luz natural) -->
                    <path
                      d="M145,80 L145,310"
                      fill="none"
                      stroke="rgba(255,255,255,0.4)"
                      stroke-width="6"
                      opacity="0.5"
                      filter="blur(3px)"
                      pointer-events="none"></path>
                    <path
                      d="M150,80 L150,310"
                      fill="none"
                      stroke="rgba(255,255,255,0.5)"
                      stroke-width="4"
                      opacity="0.6"
                      filter="blur(2px)"
                      pointer-events="none"></path>

                    <!-- Costura central decorativa (muestra construcci√≥n) -->
                    <path
                      d="M150,75 L150,315"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1"
                      stroke-dasharray="4,3"
                      opacity="0.8"
                      pointer-events="none"></path>

                    <!-- Costuras laterales (separaci√≥n de paneles) -->
                    <path
                      d="M92,85 L92,310"
                      fill="none"
                      stroke="rgba(0,0,0,0.2)"
                      stroke-width="0.8"
                      stroke-dasharray="3,2"
                      opacity="0.9"
                      pointer-events="none"></path>
                    <path
                      d="M208,85 L208,310"
                      fill="none"
                      stroke="rgba(0,0,0,0.2)"
                      stroke-width="0.8"
                      stroke-dasharray="3,2"
                      opacity="0.9"
                      pointer-events="none"></path>

                    <!-- Puntadas decorativas en hombros -->
                    <path
                      d="M120,65 Q135,68 150,68 Q165,68 180,65"
                      fill="none"
                      stroke="rgba(0,0,0,0.3)"
                      stroke-width="1.2"
                      stroke-dasharray="2,2"
                      pointer-events="none"></path>

                    <!-- Costuras de hombros con sombra -->
                    <path
                      d="M84,85 L120,65"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1.2"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>
                    <path
                      d="M216,85 L180,65"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1.2"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>

                    <!-- Refuerzo de cintura con puntadas -->
                    <path
                      d="M95,318 L205,318"
                      fill="none"
                      stroke="rgba(0,0,0,0.3)"
                      stroke-width="1.5"
                      pointer-events="none"></path>
                    <path
                      d="M95,316 L205,316"
                      fill="none"
                      stroke="rgba(0,0,0,0.18)"
                      stroke-width="0.8"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>

                    <!-- Manga izquierda HIPERREALISTA con volumen y detalles -->
                    <path
                      id="mangaIzqFrontal"
                      class="parte-poleron"
                      data-parte="mangas"
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadow)"></path>

                    <!-- Textura de tela en manga izquierda -->
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#fabricTexture)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#jerseyTexture)"
                      opacity="1"
                      pointer-events="none"></path>

                    <!-- Gradiente de volumen en manga izquierda -->
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#sleeveGradient)"
                      opacity="0.5"
                      pointer-events="none"></path>

                    <!-- Sombra profunda manga izquierda -->
                    <path
                      d="M38,118 L34,130 L34,208 C34,212 36,216 40,218"
                      fill="none"
                      stroke="rgba(0,0,0,0.35)"
                      stroke-width="12"
                      opacity="0.6"
                      pointer-events="none"></path>

                    <!-- Sombra difuminada manga izquierda -->
                    <path
                      d="M40,120 L36,135 L36,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.2)"
                      stroke-width="8"
                      filter="blur(3px)"
                      pointer-events="none"></path>

                    <!-- Costura principal manga izquierda -->
                    <path
                      d="M52,108 L44,130 L44,205 L52,220"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>

                    <!-- Pliegues naturales manga izquierda -->
                    <path
                      d="M58,135 Q54,140 50,145"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>
                    <path
                      d="M60,160 Q56,165 52,170"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>
                    <path
                      d="M62,185 Q58,190 54,195"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>

                    <!-- Highlights manga izquierda -->
                    <path
                      d="M72,100 L68,120 L68,210"
                      fill="none"
                      stroke="rgba(255,255,255,0.3)"
                      stroke-width="4"
                      filter="blur(2px)"
                      pointer-events="none"></path>

                    <!-- Manga derecha HIPERREALISTA con volumen y detalles -->
                    <path
                      id="mangaDerFrontal"
                      class="parte-poleron"
                      data-parte="mangas"
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadow)"></path>

                    <!-- Textura de tela en manga derecha -->
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#fabricTexture)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#jerseyTexture)"
                      opacity="1"
                      pointer-events="none"></path>

                    <!-- Gradiente de volumen en manga derecha -->
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#sleeveGradient)"
                      opacity="0.5"
                      transform="scale(-1,1) translate(-300,0)"
                      pointer-events="none"></path>

                    <!-- Sombra profunda manga derecha -->
                    <path
                      d="M262,118 L266,130 L266,208 C266,212 264,216 260,218"
                      fill="none"
                      stroke="rgba(0,0,0,0.35)"
                      stroke-width="12"
                      opacity="0.6"
                      pointer-events="none"></path>

                    <!-- Sombra difuminada manga derecha -->
                    <path
                      d="M260,120 L264,135 L264,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.2)"
                      stroke-width="8"
                      filter="blur(3px)"
                      pointer-events="none"></path>

                    <!-- Costura principal manga derecha -->
                    <path
                      d="M248,108 L256,130 L256,205 L248,220"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>

                    <!-- Pliegues naturales manga derecha -->
                    <path
                      d="M242,135 Q246,140 250,145"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>
                    <path
                      d="M240,160 Q244,165 248,170"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>
                    <path
                      d="M238,185 Q242,190 246,195"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1.5"
                      pointer-events="none"></path>

                    <!-- Highlights manga derecha -->
                    <path
                      d="M228,100 L232,120 L232,210"
                      fill="none"
                      stroke="rgba(255,255,255,0.3)"
                      stroke-width="4"
                      filter="blur(2px)"
                      pointer-events="none"></path>

                    <!-- Cuello americano en V (sin capucha) -->
                    <g id="cuelloFrontal">
                      <!-- Sombra exterior del cuello -->
                      <path
                        d="M120,92 Q150,96 180,92"
                        fill="none"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="6"
                        filter="blur(2px)"></path>

                      <!-- Banda izquierda del cuello en V -->
                      <path
                        class="parte-poleron"
                        data-parte="cuello"
                        d="M120,86 L136,66 Q144,58 150,64 L150,82 L124,90 Q120,88 120,86 Z"
                        fill="#3a3a3a"
                        stroke="#0a0a0a"
                        stroke-width="1.4"
                        stroke-linejoin="round"
                        filter="url(#softShadow)"></path>
                      <!-- Texturas banda izquierda -->
                      <path
                        d="M120,86 L136,66 Q144,58 150,64 L150,82 L124,90 Q120,88 120,86 Z"
                        fill="url(#fabricTexture)"
                        opacity="0.5"
                        pointer-events="none"></path>
                      <path
                        d="M120,86 L136,66 Q144,58 150,64 L150,82 L124,90 Q120,88 120,86 Z"
                        fill="url(#jerseyTexture)"
                        opacity="0.45"
                        pointer-events="none"></path>

                      <!-- Banda derecha del cuello en V -->
                      <path
                        class="parte-poleron"
                        data-parte="cuello"
                        d="M180,86 L164,66 Q156,58 150,64 L150,82 L176,90 Q180,88 180,86 Z"
                        fill="#3a3a3a"
                        stroke="#0a0a0a"
                        stroke-width="1.4"
                        stroke-linejoin="round"
                        filter="url(#softShadow)"></path>
                      <!-- Texturas banda derecha -->
                      <path
                        d="M180,86 L164,66 Q156,58 150,64 L150,82 L176,90 Q180,88 180,86 Z"
                        fill="url(#fabricTexture)"
                        opacity="0.5"
                        pointer-events="none"></path>
                      <path
                        d="M180,86 L164,66 Q156,58 150,64 L150,82 L176,90 Q180,88 180,86 Z"
                        fill="url(#jerseyTexture)"
                        opacity="0.45"
                        pointer-events="none"></path>

                      <!-- Costura interior y brillo en el v√©rtice -->
                      <path
                        d="M150,64 L150,84"
                        stroke="rgba(0,0,0,0.45)"
                        stroke-width="1.2"
                        stroke-dasharray="3,2"></path>
                      <path
                        d="M140,66 Q150,60 160,66"
                        fill="none"
                        stroke="rgba(255,255,255,0.18)"
                        stroke-width="2"></path>
                    </g>

                    <!-- Canes√∫/hombros estilo varsity y l√≠neas de sisa -->
                    <path
                      d="M96,90 Q150,74 204,90"
                      fill="none"
                      stroke="rgba(0,0,0,0.35)"
                      stroke-width="1.2"
                      stroke-dasharray="3,2"></path>
                    <path
                      d="M96,90 L88,118"
                      fill="none"
                      stroke="rgba(0,0,0,0.3)"
                      stroke-width="1"
                      stroke-dasharray="3,2"></path>
                    <path
                      d="M204,90 L212,118"
                      fill="none"
                      stroke="rgba(0,0,0,0.3)"
                      stroke-width="1"
                      stroke-dasharray="3,2"></path>

                    <!-- Capucha/Gorro ultra realista (oculto por defecto) -->
                    <g id="gorroFrontal" style="display:none;">
                      <!-- Capucha exterior con forma tridimensional -->
                      <path
                        class="parte-poleron gorro-exterior"
                        data-parte="cuello"
                        d="M106,62 Q104,44 118,24 C132,8 140,6 150,6 C160,6 168,8 182,24 Q196,44 194,62 L194,72 Q194,78 188,80 L150,86 L112,80 Q106,78 106,72 Z"
                        fill="#3a3a3a"
                        stroke="#0a0a0a"
                        stroke-width="1.8"
                        stroke-linejoin="round"
                        filter="url(#deepShadow)"></path>
                      <path
                        d="M106,62 Q104,44 118,24 C132,8 140,6 150,6 C160,6 168,8 182,24 Q196,44 194,62 L194,72 Q194,78 188,80 L150,86 L112,80 Q106,78 106,72 Z"
                        fill="url(#fabricTexture)"
                        opacity="0.6"
                        pointer-events="none"></path>
                      <path
                        d="M106,62 Q104,44 118,24 C132,8 140,6 150,6 C160,6 168,8 182,24 Q196,44 194,62 L194,72 Q194,78 188,80 L150,86 L112,80 Q106,78 106,72 Z"
                        fill="url(#jerseyTexture)"
                        opacity="0.5"
                        pointer-events="none"></path>
                      <path
                        d="M106,62 Q104,44 118,24 C132,8 140,6 150,6 C160,6 168,8 182,24 Q196,44 194,62 L194,72 Q194,78 188,80 L150,86 L112,80 Q106,78 106,72 Z"
                        fill="url(#hoodGradientFront)"
                        opacity="0.45"
                        pointer-events="none"></path>

                      <!-- Forro interior visible y coloreable -->
                      <path
                        id="forroGorroFrontal"
                        class="parte-poleron"
                        data-parte="forro"
                        d="M114,64 Q112,48 124,32 C136,18 144,16 150,16 C156,16 164,18 176,32 Q188,48 186,64 L186,70 Q186,74 182,76 L150,80 L118,76 Q114,74 114,70 Z"
                        fill="#999999"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#softShadow)"></path>

                      <!-- Refuerzos y costuras -->
                      <path
                        d="M150,6 L150,82"
                        stroke="rgba(0,0,0,0.45)"
                        stroke-width="1.5"
                        stroke-dasharray="3,2"
                        fill="none"></path>
                      <path
                        d="M132,10 Q120,30 116,50 Q114,60 114,70"
                        fill="none"
                        stroke="rgba(0,0,0,0.25)"
                        stroke-width="1.1"
                        stroke-dasharray="2,2"></path>
                      <path
                        d="M168,10 Q180,30 184,50 Q186,60 186,70"
                        fill="none"
                        stroke="rgba(0,0,0,0.25)"
                        stroke-width="1.1"
                        stroke-dasharray="2,2"></path>
                      <path
                        d="M120,28 Q134,14 150,10"
                        fill="none"
                        stroke="rgba(255,255,255,0.2)"
                        stroke-width="2"
                        opacity="0.8"></path>
                      <path
                        d="M180,28 Q166,14 150,10"
                        fill="none"
                        stroke="rgba(255,255,255,0.12)"
                        stroke-width="2"
                        opacity="0.7"></path>

                      <!-- Sutura inferior del gorro -->
                      <path
                        d="M110,78 Q150,84 190,78"
                        fill="none"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="1.4"></path>

                      <!-- Sin cordones (no se dibujan) -->
                    </g>

                    <!-- Cierre completo ultra detallado (oculto por defecto) -->
                    <g id="cierreFrontal" style="display:none;">
                      <!-- Base del cierre -->
                      <rect
                        x="147"
                        y="68"
                        width="6"
                        height="250"
                        fill="#5a5a5a"
                        rx="1"
                        filter="url(#softShadow)"></rect>

                      <!-- Dientes de cremallera met√°licos -->
                      <g opacity="0.8">
                        <rect
                          x="145"
                          y="72"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="72"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="82"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="82"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="92"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="92"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="102"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="102"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="112"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="112"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="122"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="122"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="132"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="132"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="142"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="142"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="152"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="152"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="162"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="162"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="172"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="172"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                      </g>

                      <!-- Tirador del cierre -->
                      <circle
                        cx="150"
                        cy="75"
                        r="4"
                        fill="#6a6a6a"
                        stroke="#0a0a0a"
                        stroke-width="0.8"></circle>
                      <rect
                        x="148"
                        y="78"
                        width="4"
                        height="8"
                        rx="1"
                        fill="#6a6a6a"></rect>
                    </g>

                    <!-- Cierre CORTO (hasta medio pecho) -->
                    <g id="cierreFrontalCorto" style="display:none;">
                      <!-- Base del cierre corto -->
                      <rect
                        x="147"
                        y="68"
                        width="6"
                        height="120"
                        fill="#5a5a5a"
                        rx="1"
                        filter="url(#softShadow)"></rect>

                      <!-- Dientes de cremallera met√°licos (menos cantidad) -->
                      <g opacity="0.8">
                        <rect
                          x="145"
                          y="72"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="72"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="82"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="82"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="92"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="92"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="102"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="102"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="112"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="112"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="122"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="122"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="132"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="132"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="142"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="142"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="152"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="152"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="162"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="162"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="172"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="172"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="145"
                          y="182"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                        <rect
                          x="152"
                          y="182"
                          width="3"
                          height="4"
                          fill="#888"
                          rx="0.5"></rect>
                      </g>

                      <!-- Tirador del cierre -->
                      <circle
                        cx="150"
                        cy="75"
                        r="4"
                        fill="#6a6a6a"
                        stroke="#0a0a0a"
                        stroke-width="0.8"></circle>
                      <rect
                        x="148"
                        y="78"
                        width="4"
                        height="8"
                        rx="1"
                        fill="#6a6a6a"></rect>

                      <!-- Final del cierre con refuerzo -->
                      <rect
                        x="146"
                        y="185"
                        width="8"
                        height="4"
                        rx="2"
                        fill="#6a6a6a"></rect>
                    </g>

                    <!-- Placket con broches (para 'sin-cierre') -->
                    <g id="brochesFrontal" style="display:block;">
                      <!-- Tira central -->
                      <rect
                        x="146"
                        y="68"
                        width="8"
                        height="250"
                        fill="#3f3f3f"
                        rx="1"
                        filter="url(#softShadow)"></rect>
                      <rect
                        x="146"
                        y="68"
                        width="8"
                        height="250"
                        fill="url(#fabricTexture)"
                        opacity="0.4"
                        pointer-events="none"></rect>
                      <!-- L√≠nea de broches -->
                      <g fill="#1a1a1a" stroke="#e5e5e5" stroke-width="0.7">
                        <circle cx="150" cy="80" r="3.6"></circle>
                        <circle cx="150" cy="104" r="3.6"></circle>
                        <circle cx="150" cy="128" r="3.6"></circle>
                        <circle cx="150" cy="152" r="3.6"></circle>
                        <circle cx="150" cy="176" r="3.6"></circle>
                        <circle cx="150" cy="200" r="3.6"></circle>
                        <circle cx="150" cy="224" r="3.6"></circle>
                        <circle cx="150" cy="248" r="3.6"></circle>
                        <circle cx="150" cy="272" r="3.6"></circle>
                        <circle cx="150" cy="296" r="3.6"></circle>
                      </g>
                    </g>

                    <!-- Bolsillo CANGURO √∫nico y realista (sin cierre) -->
                    <g id="bolsilloCanguro" style="display:none;">
                      <!-- Bolsillo principal con profundidad -->
                      <path
                        class="parte-poleron"
                        data-parte="bolsillos"
                        d="M105,175 Q103,178 103,182 L103,215 Q103,220 108,222 L192,222 Q197,220 197,215 L197,182 Q197,178 195,175 Z"
                        fill="#FFFFFF"
                        stroke="#0a0a0a"
                        stroke-width="1.5"
                        stroke-linejoin="round"
                        filter="url(#softShadow)"></path>

                      <!-- Abertura superior del bolsillo con sombra profunda -->
                      <path
                        d="M108,177 L192,177"
                        stroke="#0a0a0a"
                        stroke-width="2"
                        stroke-linecap="round"></path>

                      <!-- Profundidad interior oscura -->
                      <rect
                        x="108"
                        y="177"
                        width="84"
                        height="12"
                        fill="url(#pocketDepth)"
                        rx="1"></rect>

                      <!-- Costuras decorativas laterales -->
                      <path
                        d="M105,178 L105,218"
                        stroke="rgba(0,0,0,0.2)"
                        stroke-width="1"
                        stroke-dasharray="3,2"></path>
                      <path
                        d="M195,178 L195,218"
                        stroke="rgba(0,0,0,0.2)"
                        stroke-width="1"
                        stroke-dasharray="3,2"></path>

                      <!-- Refuerzo inferior del bolsillo -->
                      <path
                        d="M108,220 Q150,223 192,220"
                        fill="none"
                        stroke="rgba(0,0,0,0.15)"
                        stroke-width="1.2"></path>
                    </g>

                    <!-- Bolsillos DIAGONALES (estilo deportivo) -->
                    <!-- Bolsillo diagonal izquierdo -->
                    <g id="bolsilloDiagonalIzq">
                      <!-- Sombra exterior profunda (base) -->
                      <path
                        d="M100,226 Q99,224 98,216 Q98,215 98,213 L110,183 Q111,182 112,182 Q114,182 118,191 Q119,192 120,194 Q122,208 119,217 Q116,225 114,227 Q112,228 100,226 Z"
                        fill="rgba(0,0,0,0.3)"
                        filter="blur(3px)"></path>

                      <!-- Sombra media -->
                      <path
                        d="M100,225.5 Q99,223.5 98,215.5 Q98,214.5 98,212.5 L110,182.5 Q111,181.5 112,181.5 Q114,181.5 118,190.5 Q119,191.5 120,193.5 Q122,207.5 119,216.5 Q116,224.5 114,226.5 Q112,227.5 100,225.5 Z"
                        fill="rgba(0,0,0,0.15)"
                        filter="blur(2px)"></path>

                      <!-- Cuerpo del bolsillo con forma de "C" girado 245¬∞ -->
                      <path
                        class="parte-poleron"
                        data-parte="bolsillos"
                        d="M100,225 Q99,223 98,215 Q98,214 98,212 L110,182 Q111,181 112,181 Q114,181 118,190 Q119,191 120,193 Q122,207 119,216 Q116,224 114,226 Q112,227 100,225 Z"
                        fill="#FFFFFF"
                        stroke="#0a0a0a"
                        stroke-width="2.5"
                        stroke-linejoin="round"
                        filter="url(#softShadow)"></path>

                      <!-- Sombra interior izquierda (profundidad) -->
                      <path
                        d="M100,224 Q99,222 98.5,215 L99,213 Q100,218 100.5,222 Z"
                        fill="rgba(0,0,0,0.4)"
                        opacity="0.8"></path>

                      <!-- Sombra interior gradual -->
                      <path
                        d="M101,224 Q100,221 99,215 Q99,214 99,212 L105,190 Q106,189 107,189 L101,215 Q101,220 101,224 Z"
                        fill="rgba(0,0,0,0.2)"
                        opacity="0.6"></path>

                      <!-- Abertura lateral con sombra -->
                      <line
                        x1="100"
                        y1="224"
                        x2="98"
                        y2="214"
                        stroke="#000000"
                        stroke-width="3.5"
                        stroke-linecap="round"
                        opacity="0.3"></line>
                      <line
                        x1="100"
                        y1="224"
                        x2="98"
                        y2="214"
                        stroke="#0a0a0a"
                        stroke-width="3"
                        stroke-linecap="round"></line>

                      <!-- Profundidad interior mejorada -->
                      <path
                        d="M100,224 Q99,222 98,214 L100,207 Q104,215 106,217 Z"
                        fill="url(#pocketDepth)"
                        opacity="1"></path>

                      <!-- Highlight/brillo derecho (efecto relieve) -->
                      <path
                        d="M118,191 Q119,192 119.5,194 Q121,205 119,214 Q118,219 117,222"
                        stroke="rgba(255,255,255,0.5)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"
                        opacity="0.7"></path>

                      <!-- Highlight sutil superior -->
                      <path
                        d="M110,183 Q111,182 112,182 Q113,182 116,188"
                        stroke="rgba(255,255,255,0.4)"
                        stroke-width="1"
                        stroke-linecap="round"
                        fill="none"
                        opacity="0.6"></path>

                      <!-- L√≠neas decorativas con sombra mejorada -->
                      <path
                        d="M111,217 Q109,214 106,207"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M112,210 Q110,207 108,200"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M114,203 Q112,200 110,193"
                        stroke="rgba(0,0,0,0.3)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M116,196 Q114,193 113,186"
                        stroke="rgba(0,0,0,0.25)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>

                      <!-- Sombra profunda en la base -->
                      <rect
                        x="100"
                        y="213"
                        width="8"
                        height="6"
                        fill="rgba(0,0,0,0.35)"
                        transform="rotate(-85 104 216)"></rect>

                      <!-- Sombra adicional difuminada -->
                      <ellipse
                        cx="102"
                        cy="220"
                        rx="4"
                        ry="8"
                        fill="rgba(0,0,0,0.2)"
                        transform="rotate(-85 102 220)"
                        filter="blur(2px)"></ellipse>
                    </g>
                    <!-- Bolsillo diagonal derecho -->
                    <g id="bolsilloDiagonalDer">
                      <!-- Sombra exterior profunda (base) -->
                      <path
                        d="M200,226 Q201,224 202,216 Q202,215 202,213 L190,183 Q189,182 188,182 Q186,182 182,191 Q181,192 180,194 Q178,208 181,217 Q184,225 186,227 Q188,228 200,226 Z"
                        fill="rgba(0,0,0,0.3)"
                        filter="blur(3px)"></path>

                      <!-- Sombra media -->
                      <path
                        d="M200,225.5 Q201,223.5 202,215.5 Q202,214.5 202,212.5 L190,182.5 Q189,181.5 188,181.5 Q186,181.5 182,190.5 Q181,191.5 180,193.5 Q178,207.5 181,216.5 Q184,224.5 186,226.5 Q188,227.5 200,225.5 Z"
                        fill="rgba(0,0,0,0.15)"
                        filter="blur(2px)"></path>

                      <!-- Cuerpo del bolsillo con forma de "C" invertida girado 245¬∞ -->
                      <path
                        class="parte-poleron"
                        data-parte="bolsillos"
                        d="M200,225 Q201,223 202,215 Q202,214 202,212 L190,182 Q189,181 188,181 Q186,181 182,190 Q181,191 180,193 Q178,207 181,216 Q184,224 186,226 Q188,227 200,225 Z"
                        fill="#FFFFFF"
                        stroke="#0a0a0a"
                        stroke-width="2.5"
                        stroke-linejoin="round"
                        filter="url(#softShadow)"></path>

                      <!-- Sombra interior derecha (profundidad) -->
                      <path
                        d="M200,224 Q201,222 201.5,215 L201,213 Q200,218 199.5,222 Z"
                        fill="rgba(0,0,0,0.4)"
                        opacity="0.8"></path>

                      <!-- Sombra interior gradual -->
                      <path
                        d="M199,224 Q200,221 201,215 Q201,214 201,212 L195,190 Q194,189 193,189 L199,215 Q199,220 199,224 Z"
                        fill="rgba(0,0,0,0.2)"
                        opacity="0.6"></path>

                      <!-- Abertura lateral con sombra -->
                      <line
                        x1="200"
                        y1="224"
                        x2="202"
                        y2="214"
                        stroke="#000000"
                        stroke-width="3.5"
                        stroke-linecap="round"
                        opacity="0.3"></line>
                      <line
                        x1="200"
                        y1="224"
                        x2="202"
                        y2="214"
                        stroke="#0a0a0a"
                        stroke-width="3"
                        stroke-linecap="round"></line>

                      <!-- Profundidad interior mejorada -->
                      <path
                        d="M200,224 Q201,222 202,214 L200,207 Q196,215 194,217 Z"
                        fill="url(#pocketDepth)"
                        opacity="1"></path>

                      <!-- Highlight/brillo izquierdo (efecto relieve) -->
                      <path
                        d="M182,191 Q181,192 180.5,194 Q179,205 181,214 Q182,219 183,222"
                        stroke="rgba(255,255,255,0.5)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"
                        opacity="0.7"></path>

                      <!-- Highlight sutil superior -->
                      <path
                        d="M190,183 Q189,182 188,182 Q187,182 184,188"
                        stroke="rgba(255,255,255,0.4)"
                        stroke-width="1"
                        stroke-linecap="round"
                        fill="none"
                        opacity="0.6"></path>

                      <!-- L√≠neas decorativas con sombra mejorada -->
                      <path
                        d="M189,217 Q191,214 194,207"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M188,210 Q190,207 192,200"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M186,203 Q188,200 190,193"
                        stroke="rgba(0,0,0,0.3)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>
                      <path
                        d="M184,196 Q186,193 187,186"
                        stroke="rgba(0,0,0,0.25)"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        fill="none"></path>

                      <!-- Sombra profunda en la base -->
                      <rect
                        x="192"
                        y="213"
                        width="8"
                        height="6"
                        fill="rgba(0,0,0,0.35)"
                        transform="rotate(85 196 216)"></rect>

                      <!-- Sombra adicional difuminada -->
                      <ellipse
                        cx="198"
                        cy="220"
                        rx="4"
                        ry="8"
                        fill="rgba(0,0,0,0.2)"
                        transform="rotate(85 198 220)"
                        filter="blur(2px)"></ellipse>
                    </g>
                    <!-- Pu√±o izquierdo HIPERREALISTA -->
                    <g id="punoIzqFrontal">
                      <!-- Sombra profunda del pu√±o -->
                      <rect
                        x="37"
                        y="219"
                        width="48"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>

                      <!-- Base del pu√±o -->
                      <rect
                        class="parte-poleron"
                        data-parte="pu√±os"
                        x="38"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#softShadow)"></rect>

                      <!-- Textura de tela el√°stica -->
                      <rect
                        x="38"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTexture)"
                        opacity="0.4"
                        pointer-events="none"></rect>

                      <!-- L√≠neas de elasticidad realistas (ribete) -->
                      <line
                        x1="40"
                        y1="220"
                        x2="82"
                        y2="220"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="40"
                        y1="222"
                        x2="82"
                        y2="222"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="40"
                        y1="224"
                        x2="82"
                        y2="224"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="40"
                        y1="226"
                        x2="82"
                        y2="226"
                        stroke="rgba(0,0,0,0.5)"
                        stroke-width="0.8"></line>
                      <line
                        x1="40"
                        y1="228"
                        x2="82"
                        y2="228"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="40"
                        y1="230"
                        x2="82"
                        y2="230"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="40"
                        y1="232"
                        x2="82"
                        y2="232"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>

                      <!-- Sombra interna superior -->
                      <rect
                        x="40"
                        y="218"
                        width="42"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.3)"
                        pointer-events="none"></rect>

                      <!-- Highlight inferior -->
                      <rect
                        x="40"
                        y="231"
                        width="42"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                    </g>

                    <!-- Pu√±o derecho HIPERREALISTA -->
                    <g id="punoDerFrontal">
                      <!-- Sombra profunda del pu√±o -->
                      <rect
                        x="215"
                        y="219"
                        width="48"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>

                      <!-- Base del pu√±o -->
                      <rect
                        class="parte-poleron"
                        data-parte="pu√±os"
                        x="216"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#softShadow)"></rect>

                      <!-- Textura de tela el√°stica -->
                      <rect
                        x="216"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTexture)"
                        opacity="0.4"
                        pointer-events="none"></rect>

                      <!-- L√≠neas de elasticidad realistas (ribete) -->
                      <line
                        x1="218"
                        y1="220"
                        x2="260"
                        y2="220"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="218"
                        y1="222"
                        x2="260"
                        y2="222"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="218"
                        y1="224"
                        x2="260"
                        y2="224"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="218"
                        y1="226"
                        x2="260"
                        y2="226"
                        stroke="rgba(0,0,0,0.5)"
                        stroke-width="0.8"></line>
                      <line
                        x1="218"
                        y1="228"
                        x2="260"
                        y2="228"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="218"
                        y1="230"
                        x2="260"
                        y2="230"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="218"
                        y1="232"
                        x2="260"
                        y2="232"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>

                      <!-- Sombra interna superior -->
                      <rect
                        x="218"
                        y="218"
                        width="42"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.3)"
                        pointer-events="none"></rect>

                      <!-- Highlight inferior -->
                      <rect
                        x="218"
                        y="231"
                        width="42"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                    </g>

                    <!-- Cintura HIPERREALISTA -->
                    <g id="cinturaFrontal">
                      <!-- Sombra profunda de la cintura -->
                      <rect
                        x="83"
                        y="306"
                        width="134"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>

                      <!-- Base de la cintura -->
                      <rect
                        class="parte-poleron"
                        data-parte="cintura"
                        x="84"
                        y="305"
                        width="132"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#softShadow)"></rect>

                      <!-- Textura de tela el√°stica -->
                      <rect
                        x="84"
                        y="305"
                        width="132"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTexture)"
                        opacity="0.4"
                        pointer-events="none"></rect>

                      <!-- L√≠neas de elasticidad realistas (ribete) -->
                      <line
                        x1="86"
                        y1="307"
                        x2="214"
                        y2="307"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="86"
                        y1="309"
                        x2="214"
                        y2="309"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="86"
                        y1="311"
                        x2="214"
                        y2="311"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="86"
                        y1="313"
                        x2="214"
                        y2="313"
                        stroke="rgba(0,0,0,0.5)"
                        stroke-width="0.8"></line>
                      <line
                        x1="86"
                        y1="315"
                        x2="214"
                        y2="315"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>
                      <line
                        x1="86"
                        y1="317"
                        x2="214"
                        y2="317"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="0.6"></line>
                      <line
                        x1="86"
                        y1="319"
                        x2="214"
                        y2="319"
                        stroke="rgba(0,0,0,0.4)"
                        stroke-width="0.6"></line>

                      <!-- Sombra interna superior -->
                      <rect
                        x="86"
                        y="305"
                        width="128"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.3)"
                        pointer-events="none"></rect>

                      <!-- Highlight inferior -->
                      <rect
                        x="86"
                        y="318"
                        width="128"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                    </g>
                  </svg>

                  <!-- Modelo 1 - Frente (capas PNG con m√°scaras) -->
                  <svg
                    id="modelo1Frente"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full"
                    data-modelo="modelo-1"
                    data-vista="frente"
                  >
                    <defs>
                      <!-- M√°scaras por parte -->
                      <mask id="mk-fr-pecho"
                        ><image
                          href="/images/services/modelo_1/frente/pecho.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-mangas"
                        ><image
                          href="/images/services/modelo_1/frente/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-punos"
                        ><image
                          href="/images/services/modelo_1/frente/punos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-cintura"
                        ><image
                          href="/images/services/modelo_1/frente/cintura.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-gorro-fuera"
                        ><image
                          href="/images/services/modelo_1/frente/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-gorro-dentro"
                        ><image
                          href="/images/services/modelo_1/frente/gorro-dentro.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-bolsillo"
                        ><image
                          href="/images/services/modelo_1/frente/bolsillo.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-fr-borde-bolsillo"
                        ><image
                          href="/images/services/modelo_1/frente/borde-bolsillo.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m1f"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                    </defs>

                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m1f)"
                      pointer-events="none"></rect>

                    <!-- Capas colorizables -->
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-fr-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-fr-pecho)"></rect>
                    <g id="gorroFrontal">
                      <rect
                        data-parte="gorro-externo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#666666"
                        mask="url(#mk-fr-gorro-fuera)"></rect>
                      <rect
                        data-parte="gorro-interno"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#999999"
                        mask="url(#mk-fr-gorro-dentro)"></rect>
                    </g>
                    <rect
                      data-parte="pu√±os"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-fr-punos)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-fr-cintura)"></rect>
                    <!-- Bolsillo y borde (grupo para mostrar/ocultar) -->
                    <g id="grupoBolsilloFrente">
                      <rect
                        data-parte="bolsillo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#FFFFFF"
                        mask="url(#mk-fr-bolsillo)"></rect>
                      <rect
                        data-parte="borde-bolsillo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#000000"
                        mask="url(#mk-fr-borde-bolsillo)"></rect>
                    </g>

                    <!-- Bordes y sombras generales por encima -->
                    <image
                      href="/images/services/modelo_1/frente/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 2 - Frente -->
                  <svg
                    id="modelo2Frente"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-2"
                    data-vista="frente"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m2f"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m2-fr-pecho"
                        ><image
                          href="/images/services/modelo_2/frente/pecho.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m2-fr-mangas"
                        ><image
                          href="/images/services/modelo_2/frente/mangas-y-bolsillos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m2-fr-color1"
                        ><image
                          href="/images/services/modelo_2/frente/color1.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m2f)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m2-fr-pecho)"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m2-fr-mangas)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m2-fr-color1)"></rect>
                    <image
                      href="/images/services/modelo_2/frente/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 3 - Frente -->
                  <svg
                    id="modelo3Frente"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-3"
                    data-vista="frente"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m3f"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m3-fr-color1"
                        ><image
                          href="/images/services/modelo_3/frente/color1.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-fr-color2"
                        ><image
                          href="/images/services/modelo_3/frente/color2.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-fr-pretina"
                        ><image
                          href="/images/services/modelo_3/frente/fondo-pretina.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-fr-rayas-pretina"
                        ><image
                          href="/images/services/modelo_3/frente/rayas-pretina.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m3f)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m3-fr-color1)"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m3-fr-color2)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m3-fr-pretina)"></rect>
                    <rect
                      data-parte="rayas-pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m3-fr-rayas-pretina)"></rect>
                    <image
                      href="/images/services/modelo_3/frente/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 4 - Frente (Combinaci√≥n Modelo 1 + Modelo 3) -->
                  <svg
                    id="modelo4Frente"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-4"
                    data-vista="frente"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m4f"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m4-fr-pecho">
                        <image
                          href="/images/services/modelo_4/frente/pecho.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-mangas">
                        <image
                          href="/images/services/modelo_4/frente/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-punos">
                        <image
                          href="/images/services/modelo_4/frente/punos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-cintura">
                        <image
                          href="/images/services/modelo_4/frente/cintura.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-gorro-dentro">
                        <image
                          href="/images/services/modelo_4/frente/gorro-dentro.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-gorro-fuera">
                        <image
                          href="/images/services/modelo_4/frente/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-pretina">
                        <image
                          href="/images/services/modelo_4/frente/fondo-pretina.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-rayas-pretina">
                        <image
                          href="/images/services/modelo_4/frente/rayaas-pretina.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-fr-borde-bolsillo">
                        <image
                          href="/images/services/modelo_4/frente/borde-bolsillo.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m4f)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-pecho)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-cintura)"></rect>
                    <rect
                      data-parte="pu√±os"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-punos)"></rect>
                    <rect
                      data-parte="gorro-externo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-gorro-fuera)"></rect>
                    <rect
                      data-parte="gorro-interno"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#CCCCCC"
                      mask="url(#mk-m4-fr-gorro-dentro)"></rect>
                    <rect
                      data-parte="pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-fr-pretina)"></rect>
                    <rect
                      data-parte="rayas-pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m4-fr-rayas-pretina)"></rect>
                    <rect
                      data-parte="borde-bolsillo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m4-fr-borde-bolsillo)"></rect>
                    <image
                      href="/images/services/modelo_4/frente/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 5 - Frente -->
                  <svg
                    id="modelo5Frente"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-5"
                    data-vista="frente"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m5f"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m5-fr-pecho"
                        ><image
                          href="/images/services/modelo_5/frente/pecho.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-mangas"
                        ><image
                          href="/images/services/modelo_5/frente/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-punos"
                        ><image
                          href="/images/services/modelo_5/frente/punos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-cintura"
                        ><image
                          href="/images/services/modelo_5/frente/cintura.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-gorro-dentro"
                        ><image
                          href="/images/services/modelo_5/frente/gorro-dentro.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-gorro-fuera"
                        ><image
                          href="/images/services/modelo_5/frente/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-bolsillo"
                        ><image
                          href="/images/services/modelo_5/frente/bolsillo.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-fr-borde-bolsillo"
                        ><image
                          href="/images/services/modelo_5/frente/borde-bolsillos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m5f)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-fr-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-fr-pecho)"></rect>
                    <rect
                      data-parte="pu√±os"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-fr-punos)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-fr-cintura)"></rect>
                    <g class="gorro-grupo">
                      <rect
                        data-parte="gorro-externo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#FFFFFF"
                        mask="url(#mk-m5-fr-gorro-fuera)"></rect>
                      <rect
                        data-parte="gorro-interno"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#CCCCCC"
                        mask="url(#mk-m5-fr-gorro-dentro)"></rect>
                    </g>
                    <rect
                      data-parte="bolsillo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-fr-bolsillo)"></rect>
                    <rect
                      data-parte="borde-bolsillo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m5-fr-borde-bolsillo)"></rect>
                    <image
                      href="/images/services/modelo_5/frente/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>
                </div>
              </div>

              <!-- Vista Trasera -->
              <div
                data-vista-container="trasera"
                class="transition-all duration-300 cursor-pointer"
                id="contenedorTrasero"
              >
                <h3 class="text-center font-bold text-gray-700 mb-4">
                  Espalda
                </h3>
                <div
                  class="bg-gray-100 rounded-lg p-4 flex items-center justify-center hover:bg-gray-200 transition-colors border-4 border-transparent"
                >
                  <svg
                    id="svgTrasero"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full"
                    style="display:none;"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="watermarkPatternBack"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <!-- Gradientes y texturas para la vista trasera -->
                      <linearGradient
                        id="bodyGradientBack"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="0%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(0,0,0,0.25);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="15%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="50%"
                          style="stop-color:rgba(255,255,255,0.08);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="85%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.25);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="bodyGradientBackVertical"
                        x1="0%"
                        y1="0%"
                        x2="0%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(255,255,255,0.15);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="40%"
                          style="stop-color:rgba(0,0,0,0);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.18);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="sleeveGradientBack"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="0%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(0,0,0,0.3);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="50%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(255,255,255,0.12);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <linearGradient
                        id="hoodGradientBack"
                        x1="0%"
                        y1="0%"
                        x2="0%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color:rgba(255,255,255,0.2);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="60%"
                          style="stop-color:rgba(0,0,0,0.12);stop-opacity:1"
                        ></stop>
                        <stop
                          offset="100%"
                          style="stop-color:rgba(0,0,0,0.3);stop-opacity:1"
                        ></stop>
                      </linearGradient>

                      <pattern
                        id="fabricTextureBack"
                        x="0"
                        y="0"
                        width="4"
                        height="4"
                        patternUnits="userSpaceOnUse"
                      >
                        <rect width="4" height="4" fill="rgba(0,0,0,0.02)"
                        ></rect>
                        <path
                          d="M0,0 L4,4 M4,0 L0,4"
                          stroke="rgba(0,0,0,0.03)"
                          stroke-width="0.5"></path>
                      </pattern>

                      <pattern
                        id="jerseyTextureBack"
                        x="0"
                        y="0"
                        width="6"
                        height="3"
                        patternUnits="userSpaceOnUse"
                      >
                        <ellipse
                          cx="1"
                          cy="1.5"
                          rx="1"
                          ry="0.8"
                          fill="rgba(0,0,0,0.04)"></ellipse>
                        <ellipse
                          cx="4"
                          cy="1.5"
                          rx="1"
                          ry="0.8"
                          fill="rgba(0,0,0,0.04)"></ellipse>
                      </pattern>

                      <filter id="softShadowBack">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="2"
                        ></feGaussianBlur>
                        <feOffset dx="0" dy="2" result="offsetblur"></feOffset>
                        <feComponentTransfer>
                          <feFuncA type="linear" slope="0.5"></feFuncA>
                        </feComponentTransfer>
                        <feMerge>
                          <feMergeNode></feMergeNode>
                          <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                      </filter>

                      <filter id="deepShadowBack">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="4"
                        ></feGaussianBlur>
                        <feOffset dx="0" dy="3" result="offsetblur"></feOffset>
                        <feComponentTransfer>
                          <feFuncA type="linear" slope="0.7"></feFuncA>
                        </feComponentTransfer>
                        <feMerge>
                          <feMergeNode></feMergeNode>
                          <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                      </filter>
                    </defs>

                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#watermarkPatternBack)"
                      pointer-events="none"></rect>

                    <!-- Cuerpo trasero hiperrealista -->
                    <path
                      id="cuerpoTrasero"
                      class="parte-poleron"
                      data-parte="cuerpo"
                      d="M82,88 Q82,86 84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 Q218,86 218,88 L216,85 L180,65 L120,65 L82,85 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadowBack)"></path>

                    <!-- Textura de tela y jersey -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#fabricTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#jerseyTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>

                    <!-- Gradientes de volumen -->
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#bodyGradientBack)"
                      opacity="0.6"
                      pointer-events="none"></path>
                    <path
                      d="M84,85 L84,305 Q84,318 95,318 L205,318 Q216,318 216,305 L216,85 L180,65 L120,65 Z"
                      fill="url(#bodyGradientBackVertical)"
                      opacity="0.5"
                      pointer-events="none"></path>

                    <!-- Sombreado profundo costados -->
                    <path
                      d="M84,90 L84,290"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="12"
                      opacity="0.65"
                      pointer-events="none"></path>
                    <path
                      d="M216,90 L216,290"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="12"
                      opacity="0.65"
                      pointer-events="none"></path>

                    <!-- Sombras difuminadas secundarias -->
                    <path
                      d="M90,95 L90,285"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="10"
                      filter="blur(3px)"
                      pointer-events="none"></path>
                    <path
                      d="M210,95 L210,285"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="10"
                      filter="blur(3px)"
                      pointer-events="none"></path>

                    <!-- Costura central y refuerzos -->
                    <path
                      d="M150,70 L150,300"
                      fill="none"
                      stroke="rgba(0,0,0,0.15)"
                      stroke-width="1"
                      stroke-dasharray="4,3"
                      pointer-events="none"></path>
                    <path
                      d="M96,85 L96,308"
                      fill="none"
                      stroke="rgba(0,0,0,0.18)"
                      stroke-width="0.8"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>
                    <path
                      d="M204,85 L204,308"
                      fill="none"
                      stroke="rgba(0,0,0,0.18)"
                      stroke-width="0.8"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>

                    <!-- Pliegues naturales espalda -->
                    <path
                      d="M100,150 Q105,155 110,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.1)"
                      stroke-width="1.4"
                      pointer-events="none"></path>
                    <path
                      d="M190,150 Q195,155 200,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.1)"
                      stroke-width="1.4"
                      pointer-events="none"></path>
                    <path
                      d="M96,205 Q101,210 106,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.2"
                      pointer-events="none"></path>
                    <path
                      d="M194,205 Q199,210 204,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.08)"
                      stroke-width="1.2"
                      pointer-events="none"></path>

                    <!-- Highlight central suave -->
                    <path
                      d="M148,85 L148,305"
                      fill="none"
                      stroke="rgba(255,255,255,0.35)"
                      stroke-width="5"
                      opacity="0.5"
                      filter="blur(2px)"
                      pointer-events="none"></path>

                    <!-- Manga izquierda trasera hiperrealista -->
                    <path
                      id="mangaIzqTrasero"
                      class="parte-poleron"
                      data-parte="mangas"
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadowBack)"></path>
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#fabricTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#jerseyTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M84,85 C80,88 76,92 72,96 L38,118 C34,122 34,126 34,130 L34,208 C34,212 36,216 40,218 L72,232 C78,234 82,233 84,230 L84,180 Z"
                      fill="url(#sleeveGradientBack)"
                      opacity="0.55"
                      pointer-events="none"></path>
                    <path
                      d="M38,118 L34,130 L34,208"
                      fill="none"
                      stroke="rgba(0,0,0,0.35)"
                      stroke-width="10"
                      opacity="0.55"
                      pointer-events="none"></path>
                    <path
                      d="M42,122 L38,138 L38,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.18)"
                      stroke-width="7"
                      filter="blur(2px)"
                      pointer-events="none"></path>
                    <path
                      d="M52,110 L44,132 L44,206 L52,222"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>
                    <path
                      d="M60,140 Q55,145 50,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>
                    <path
                      d="M62,170 Q57,175 52,180"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>
                    <path
                      d="M64,195 Q59,200 54,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>

                    <!-- Manga derecha trasera hiperrealista -->
                    <path
                      id="mangaDerTrasero"
                      class="parte-poleron"
                      data-parte="mangas"
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="#FFFFFF"
                      stroke="#0a0a0a"
                      stroke-width="2"
                      stroke-linejoin="round"
                      filter="url(#deepShadowBack)"></path>
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#fabricTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#jerseyTextureBack)"
                      opacity="1"
                      pointer-events="none"></path>
                    <path
                      d="M216,85 C220,88 224,92 228,96 L262,118 C266,122 266,126 266,130 L266,208 C266,212 264,216 260,218 L228,232 C222,234 218,233 216,230 L216,180 Z"
                      fill="url(#sleeveGradientBack)"
                      opacity="0.55"
                      transform="scale(-1,1) translate(-300,0)"
                      pointer-events="none"></path>
                    <path
                      d="M262,118 L266,130 L266,208"
                      fill="none"
                      stroke="rgba(0,0,0,0.35)"
                      stroke-width="10"
                      opacity="0.55"
                      pointer-events="none"></path>
                    <path
                      d="M258,122 L262,138 L262,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.18)"
                      stroke-width="7"
                      filter="blur(2px)"
                      pointer-events="none"></path>
                    <path
                      d="M248,110 L256,132 L256,206 L248,222"
                      fill="none"
                      stroke="rgba(0,0,0,0.25)"
                      stroke-width="1"
                      stroke-dasharray="3,2"
                      pointer-events="none"></path>
                    <path
                      d="M240,140 Q245,145 250,150"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>
                    <path
                      d="M238,170 Q243,175 248,180"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>
                    <path
                      d="M236,195 Q241,200 246,205"
                      fill="none"
                      stroke="rgba(0,0,0,0.12)"
                      stroke-width="1.3"
                      pointer-events="none"></path>

                    <!-- Cuello trasero americano elevado -->
                    <path
                      id="cuelloTrasero"
                      class="parte-poleron"
                      data-parte="cuello"
                      d="M112,86 L112,74 Q112,70 116,68 Q150,58 184,68 Q188,70 188,74 L188,86 Q188,90 184,92 L150,96 L116,92 Q112,90 112,86 Z"
                      fill="#3a3a3a"
                      stroke="#0a0a0a"
                      stroke-width="1.4"
                      filter="url(#softShadow)"></path>
                    <path
                      d="M114,84 L114,74 Q114,71 118,70 Q150,61 182,70 Q186,71 186,74 L186,84 Q186,87 182,89 L150,93 L118,89 Q114,87 114,84 Z"
                      fill="rgba(0,0,0,0.3)"
                      opacity="0.6"
                      pointer-events="none"></path>
                    <path
                      d="M112,86 L112,74 Q112,70 116,68 Q150,58 184,68 Q188,70 188,74 L188,86 Q188,90 184,92 L150,96 L116,92 Q112,90 112,86 Z"
                      fill="url(#fabricTextureBack)"
                      opacity="0.5"
                      pointer-events="none"></path>
                    <path
                      d="M112,86 L112,74 Q112,70 116,68 Q150,58 184,68 Q188,70 188,74 L188,86 Q188,90 184,92 L150,96 L116,92 Q112,90 112,86 Z"
                      fill="url(#jerseyTextureBack)"
                      opacity="0.45"
                      pointer-events="none"></path>

                    <!-- Capucha trasera ultra realista (oculta por defecto) -->
                    <g id="gorroTrasero" style="display:none;">
                      <path
                        class="parte-poleron"
                        data-parte="cuello"
                        d="M102,64 Q100,40 116,22 C132,6 140,4 150,4 C160,4 168,6 184,22 Q200,40 198,64 L198,78 Q198,86 190,88 L150,96 L110,88 Q102,86 102,78 Z"
                        fill="#3a3a3a"
                        stroke="#0a0a0a"
                        stroke-width="2"
                        stroke-linejoin="round"
                        filter="url(#deepShadowBack)"></path>
                      <path
                        d="M102,64 Q100,40 116,22 C132,6 140,4 150,4 C160,4 168,6 184,22 Q200,40 198,64 L198,78 Q198,86 190,88 L150,96 L110,88 Q102,86 102,78 Z"
                        fill="url(#fabricTextureBack)"
                        opacity="0.7"
                        pointer-events="none"></path>
                      <path
                        d="M102,64 Q100,40 116,22 C132,6 140,4 150,4 C160,4 168,6 184,22 Q200,40 198,64 L198,78 Q198,86 190,88 L150,96 L110,88 Q102,86 102,78 Z"
                        fill="url(#jerseyTextureBack)"
                        opacity="0.6"
                        pointer-events="none"></path>
                      <path
                        d="M102,64 Q100,40 116,22 C132,6 140,4 150,4 C160,4 168,6 184,22 Q200,40 198,64 L198,78 Q198,86 190,88 L150,96 L110,88 Q102,86 102,78 Z"
                        fill="url(#hoodGradientBack)"
                        opacity="0.35"
                        pointer-events="none"></path>

                      <path
                        d="M150,4 L150,95"
                        stroke="rgba(0,0,0,0.45)"
                        stroke-width="1.8"
                        stroke-dasharray="3,2"
                        fill="none"></path>
                      <path
                        d="M134,8 Q120,28 114,52 Q112,60 112,72"
                        fill="none"
                        stroke="rgba(0,0,0,0.28)"
                        stroke-width="1.2"
                        stroke-dasharray="2,2"></path>
                      <path
                        d="M166,8 Q180,28 186,52 Q188,60 188,72"
                        fill="none"
                        stroke="rgba(0,0,0,0.28)"
                        stroke-width="1.2"
                        stroke-dasharray="2,2"></path>
                      <path
                        d="M120,18 Q138,8 150,6"
                        fill="none"
                        stroke="rgba(255,255,255,0.18)"
                        stroke-width="2"
                        opacity="0.7"></path>
                      <path
                        d="M180,18 Q162,8 150,6"
                        fill="none"
                        stroke="rgba(255,255,255,0.12)"
                        stroke-width="2"
                        opacity="0.6"></path>

                      <path
                        d="M108,86 Q150,92 192,86"
                        fill="none"
                        stroke="rgba(0,0,0,0.35)"
                        stroke-width="1.5"></path>
                      <path
                        d="M122,50 Q130,54 136,50"
                        fill="none"
                        stroke="rgba(0,0,0,0.15)"
                        stroke-width="1"></path>
                      <path
                        d="M178,50 Q170,54 164,50"
                        fill="none"
                        stroke="rgba(0,0,0,0.15)"
                        stroke-width="1"></path>
                    </g>

                    <!-- Pu√±o izquierdo trasero hiperrealista -->
                    <g id="punoIzqTrasero">
                      <rect
                        x="37"
                        y="219"
                        width="48"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>
                      <rect
                        class="parte-poleron"
                        data-parte="pu√±os"
                        x="38"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#deepShadowBack)"></rect>
                      <rect
                        x="38"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTextureBack)"
                        opacity="0.5"
                        pointer-events="none"></rect>
                      <rect
                        x="38"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#fabricTextureBack)"
                        opacity="0.6"
                        pointer-events="none"></rect>
                      <rect
                        x="40"
                        y="218"
                        width="42"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.35)"
                        pointer-events="none"></rect>
                      <rect
                        x="40"
                        y="231"
                        width="42"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                      <g stroke-width="0.6" stroke-linecap="round">
                        <line
                          x1="40"
                          y1="220"
                          x2="82"
                          y2="220"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="40"
                          y1="222"
                          x2="82"
                          y2="222"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="40"
                          y1="224"
                          x2="82"
                          y2="224"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="40"
                          y1="226"
                          x2="82"
                          y2="226"
                          stroke="rgba(0,0,0,0.5)"
                          stroke-width="0.8"></line>
                        <line
                          x1="40"
                          y1="228"
                          x2="82"
                          y2="228"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="40"
                          y1="230"
                          x2="82"
                          y2="230"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="40"
                          y1="232"
                          x2="82"
                          y2="232"
                          stroke="rgba(0,0,0,0.4)"></line>
                      </g>
                    </g>

                    <!-- Pu√±o derecho trasero hiperrealista -->
                    <g id="punoDerTrasero">
                      <rect
                        x="215"
                        y="219"
                        width="48"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>
                      <rect
                        class="parte-poleron"
                        data-parte="pu√±os"
                        x="216"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#deepShadowBack)"></rect>
                      <rect
                        x="216"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTextureBack)"
                        opacity="0.5"
                        pointer-events="none"></rect>
                      <rect
                        x="216"
                        y="218"
                        width="46"
                        height="16"
                        rx="2"
                        fill="url(#fabricTextureBack)"
                        opacity="0.6"
                        pointer-events="none"></rect>
                      <rect
                        x="218"
                        y="218"
                        width="42"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.35)"
                        pointer-events="none"></rect>
                      <rect
                        x="218"
                        y="231"
                        width="42"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                      <g stroke-width="0.6" stroke-linecap="round">
                        <line
                          x1="218"
                          y1="220"
                          x2="260"
                          y2="220"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="218"
                          y1="222"
                          x2="260"
                          y2="222"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="218"
                          y1="224"
                          x2="260"
                          y2="224"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="218"
                          y1="226"
                          x2="260"
                          y2="226"
                          stroke="rgba(0,0,0,0.5)"
                          stroke-width="0.8"></line>
                        <line
                          x1="218"
                          y1="228"
                          x2="260"
                          y2="228"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="218"
                          y1="230"
                          x2="260"
                          y2="230"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="218"
                          y1="232"
                          x2="260"
                          y2="232"
                          stroke="rgba(0,0,0,0.4)"></line>
                      </g>
                    </g>

                    <!-- Cintura trasera hiperrealista -->
                    <g id="cinturaTrasera">
                      <rect
                        x="83"
                        y="306"
                        width="134"
                        height="17"
                        rx="2"
                        fill="rgba(0,0,0,0.4)"
                        filter="blur(3px)"></rect>
                      <rect
                        class="parte-poleron"
                        data-parte="cintura"
                        x="84"
                        y="305"
                        width="132"
                        height="16"
                        rx="2"
                        fill="#1a1a1a"
                        stroke="#0a0a0a"
                        stroke-width="1.2"
                        filter="url(#deepShadowBack)"></rect>
                      <rect
                        x="84"
                        y="305"
                        width="132"
                        height="16"
                        rx="2"
                        fill="url(#jerseyTextureBack)"
                        opacity="0.5"
                        pointer-events="none"></rect>
                      <rect
                        x="84"
                        y="305"
                        width="132"
                        height="16"
                        rx="2"
                        fill="url(#fabricTextureBack)"
                        opacity="0.6"
                        pointer-events="none"></rect>
                      <rect
                        x="86"
                        y="305"
                        width="128"
                        height="3"
                        rx="1"
                        fill="rgba(0,0,0,0.35)"
                        pointer-events="none"></rect>
                      <rect
                        x="86"
                        y="318"
                        width="128"
                        height="2"
                        rx="1"
                        fill="rgba(255,255,255,0.08)"
                        pointer-events="none"></rect>
                      <g stroke-width="0.6" stroke-linecap="round">
                        <line
                          x1="86"
                          y1="307"
                          x2="214"
                          y2="307"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="86"
                          y1="309"
                          x2="214"
                          y2="309"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="86"
                          y1="311"
                          x2="214"
                          y2="311"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="86"
                          y1="313"
                          x2="214"
                          y2="313"
                          stroke="rgba(0,0,0,0.5)"
                          stroke-width="0.8"></line>
                        <line
                          x1="86"
                          y1="315"
                          x2="214"
                          y2="315"
                          stroke="rgba(0,0,0,0.4)"></line>
                        <line
                          x1="86"
                          y1="317"
                          x2="214"
                          y2="317"
                          stroke="rgba(0,0,0,0.35)"></line>
                        <line
                          x1="86"
                          y1="319"
                          x2="214"
                          y2="319"
                          stroke="rgba(0,0,0,0.4)"></line>
                      </g>
                    </g>
                  </svg>

                  <!-- Modelo 1 - Espalda (capas PNG con m√°scaras) -->
                  <svg
                    id="modelo1Espalda"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full"
                    data-modelo="modelo-1"
                    data-vista="espalda"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m1b"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-bk-espalda"
                        ><image
                          href="/images/services/modelo_1/espalda/espalda.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-bk-mangas"
                        ><image
                          href="/images/services/modelo_1/espalda/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-bk-punos"
                        ><image
                          href="/images/services/modelo_1/espalda/punos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-bk-cintura"
                        ><image
                          href="/images/services/modelo_1/espalda/cintura.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-bk-gorro-fuera"
                        ><image
                          href="/images/services/modelo_1/espalda/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>

                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m1b)"
                      pointer-events="none"></rect>

                    <!-- Capas colorizables -->
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-bk-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-bk-espalda)"></rect>
                    <g id="gorroTrasero">
                      <rect
                        data-parte="gorro-externo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#666666"
                        mask="url(#mk-bk-gorro-fuera)"></rect>
                    </g>
                    <rect
                      data-parte="pu√±os"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-bk-punos)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-bk-cintura)"></rect>

                    <!-- Sombras y bordes por encima -->
                    <image
                      href="/images/services/modelo_1/espalda/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 2 - Espalda -->
                  <svg
                    id="modelo2Espalda"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-2"
                    data-vista="espalda"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m2b"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m2-bk-espalda"
                        ><image
                          href="/images/services/modelo_2/espalda/espalda.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m2-bk-mangas"
                        ><image
                          href="/images/services/modelo_2/espalda/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m2-bk-color1"
                        ><image
                          href="/images/services/modelo_2/espalda/color1.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m2b)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m2-bk-espalda)"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m2-bk-mangas)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m2-bk-color1)"></rect>
                    <image
                      href="/images/services/modelo_2/espalda/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 3 - Espalda -->
                  <svg
                    id="modelo3Espalda"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-3"
                    data-vista="espalda"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m3b"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m3-bk-color1"
                        ><image
                          href="/images/services/modelo_3/espalda/color1.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-bk-color2"
                        ><image
                          href="/images/services/modelo_3/espalda/color2.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-bk-pretina"
                        ><image
                          href="/images/services/modelo_3/espalda/fondo-pretina-a.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m3-bk-rayas-pretina"
                        ><image
                          href="/images/services/modelo_3/espalda/rayas-pretina-a.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m3b)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m3-bk-color1)"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m3-bk-color2)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m3-bk-pretina)"></rect>
                    <rect
                      data-parte="rayas-pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m3-bk-rayas-pretina)"></rect>
                    <image
                      href="/images/services/modelo_3/espalda/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 4 - Espalda -->
                  <svg
                    id="modelo4Espalda"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-4"
                    data-vista="espalda"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m4b"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m4-es-mangas">
                        <image
                          href="/images/services/modelo_4/espalda/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-es-espalda">
                        <image
                          href="/images/services/modelo_4/espalda/espalda.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-es-gorro">
                        <image
                          href="/images/services/modelo_4/espalda/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-es-pretina">
                        <image
                          href="/images/services/modelo_4/espalda/fondo-pretina-a.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                      <mask id="mk-m4-es-rayas-pretina">
                        <image
                          href="/images/services/modelo_4/espalda/rayas-pretina-a.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        />
                      </mask>
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m4b)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-es-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-es-espalda)"></rect>
                    <g class="gorro-grupo">
                      <rect
                        data-parte="gorro-externo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#FFFFFF"
                        mask="url(#mk-m4-es-gorro)"></rect>
                    </g>
                    <rect
                      data-parte="pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m4-es-pretina)"></rect>
                    <rect
                      data-parte="rayas-pretina"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#000000"
                      mask="url(#mk-m4-es-rayas-pretina)"></rect>
                    <image
                      href="/images/services/modelo_4/espalda/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>

                  <!-- Modelo 5 - Espalda -->
                  <svg
                    id="modelo5Espalda"
                    width="100%"
                    height="400"
                    viewBox="0 0 300 400"
                    class="max-w-full hidden"
                    data-modelo="modelo-5"
                    data-vista="espalda"
                  >
                    <defs>
                      <!-- Patr√≥n de marca de agua -->
                      <pattern
                        id="wmPattern_m5b"
                        x="0"
                        y="0"
                        width="80"
                        height="80"
                        patternUnits="userSpaceOnUse"
                      >
                        <image
                          href="/images/generacion_urbana_sello.jpg"
                          x="0"
                          y="0"
                          width="80"
                          height="80"
                          opacity="0.08"
                          style="filter: grayscale(100%);"
                        />
                      </pattern>
                      <mask id="mk-m5-es-espalda"
                        ><image
                          href="/images/services/modelo_5/espalda/espalda.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-es-mangas"
                        ><image
                          href="/images/services/modelo_5/espalda/mangas.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-es-punos"
                        ><image
                          href="/images/services/modelo_5/espalda/punos.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-es-cintura"
                        ><image
                          href="/images/services/modelo_5/espalda/cintura.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                      <mask id="mk-m5-es-gorro"
                        ><image
                          href="/images/services/modelo_5/espalda/gorro-fuera.png"
                          x="0"
                          y="0"
                          width="300"
                          height="400"
                          preserveAspectRatio="none"
                        /></mask
                      >
                    </defs>
                    <!-- Fondo con patr√≥n de marca de agua -->
                    <rect
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="url(#wmPattern_m5b)"
                      pointer-events="none"></rect>
                    <rect
                      data-parte="mangas"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-es-mangas)"></rect>
                    <rect
                      data-parte="cuerpo"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-es-espalda)"></rect>
                    <rect
                      data-parte="pu√±os"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-es-punos)"></rect>
                    <rect
                      data-parte="cintura"
                      class="parte-poleron"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      fill="#FFFFFF"
                      mask="url(#mk-m5-es-cintura)"></rect>
                    <g class="gorro-grupo">
                      <rect
                        data-parte="gorro-externo"
                        class="parte-poleron"
                        x="0"
                        y="0"
                        width="300"
                        height="400"
                        fill="#FFFFFF"
                        mask="url(#mk-m5-es-gorro)"></rect>
                    </g>
                    <image
                      href="/images/services/modelo_5/espalda/sombra-y-borde.png"
                      x="0"
                      y="0"
                      width="300"
                      height="400"
                      preserveAspectRatio="none"
                      style="pointer-events:none"
                    />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="mt-4 space-y-3">
              <button
                id="btnGuardar"
                class="w-full px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all"
                style="box-shadow: 0 0 15px rgba(220, 38, 38, 0.6), 0 0 30px rgba(220, 38, 38, 0.4); text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);"
              >
                Guardar Dise√±o
              </button>
              <button
                id="btnWhatsApp"
                class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition-all"
                style="box-shadow: 0 0 15px rgba(34, 197, 94, 0.6), 0 0 30px rgba(34, 197, 94, 0.4); text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);"
              >
                Compartir
              </button>
              <button
                id="btnReset"
                class="w-full px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg transition-colors"
              >
                Reiniciar
              </button>
            </div>
          </div>
        </div>

        <!-- columna derecha -->
        <div class="lg:col-span-3 space-y-6">
          <!-- Panel de Capas -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="font-bold text-lg text-gray-800 mb-4">Capas</h3>
            <div
              id="listaCapas"
              class="space-y-2 overflow-y-auto"
              style="max-height: 210px;"
            >
              <!-- Las capas se renderizar√°n aqu√≠ -->
              <div class="text-center text-gray-500 text-sm py-4">
                No hay elementos agregados
              </div>
            </div>
          </div>

          <!-- Info del dise√±o actual -->
          <div class="bg-white rounded-xl shadow-lg p-6 space-y-4">
            <h3 class="font-bold text-lg text-gray-800">
              Info del dise√±o actual
            </h3>
            <div id="infoDiseno" class="text-sm text-gray-700 space-y-3">
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div class="text-gray-600">Modelo</div>
                <div id="infoModelo" class="font-semibold text-right">
                  Modelo 1
                </div>
                <div
                  id="infoTipoPrendaLabel"
                  class="text-gray-600"
                  style="display:none;"
                >
                  Tipo de Prenda
                </div>
                <div
                  id="infoTipoPrenda"
                  class="font-semibold text-right"
                  style="display:none;"
                >
                  Poler√≥n
                </div>
                <div
                  id="infoTipoCierreLabel"
                  class="text-gray-600"
                  style="display:none;"
                >
                  Tipo de Cierre
                </div>
                <div
                  id="infoTipoCierre"
                  class="font-semibold text-right"
                  style="display:none;"
                >
                  Cierre y Broche
                </div>
                <div class="text-gray-600">Parte seleccionada</div>
                <div id="infoParte" class="font-semibold text-right">
                  Cuerpo
                </div>
              </div>

              <div>
                <div class="font-semibold text-gray-800 mb-1">Colores</div>
                <ul
                  id="infoColores"
                  class="text-xs text-gray-600 space-y-1 bg-gray-50 rounded-lg p-3 border border-gray-100"
                >
                  <li class="text-gray-500">Sin datos</li>
                </ul>
              </div>

              <div>
                <div class="font-semibold text-gray-800 mb-1">Textos</div>
                <ul
                  id="infoTextos"
                  class="text-xs text-gray-600 divide-y divide-gray-100 bg-gray-50 rounded-lg border border-gray-100"
                >
                  <li class="py-2 px-3 text-gray-500">Sin textos</li>
                </ul>
              </div>

              <div>
                <div class="font-semibold text-gray-800 mb-1">Im√°genes</div>
                <div
                  id="infoImagenes"
                  class="text-xs text-gray-600 space-y-1 bg-gray-50 rounded-lg p-3 border border-gray-100"
                >
                  <div class="text-gray-500">Sin im√°genes</div>
                </div>
              </div>

              <div class="flex items-center justify-between text-xs">
                <span class="font-semibold text-gray-800"
                  >¬øTexto con emojis?</span
                >
                <span
                  id="infoTieneEmoji"
                  class="px-2 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold"
                  >No</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n Adicional -->
      <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
        <div class="text-center">
          <h3 class="font-bold text-xl mb-3 text-gray-800">
            ¬øListo con tu dise√±o?
          </h3>
          <p class="text-gray-600 mb-4">
            Guarda tu dise√±o y env√≠anos un WhatsApp para cotizar y producir tu
            poler√≥n personalizado
          </p>
          <a
            href="/contacto"
            class="inline-block px-8 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all"
            style="box-shadow: 0 0 15px rgba(220, 38, 38, 0.6), 0 0 30px rgba(220, 38, 38, 0.4); text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);"
          >
            Solicitar Cotizaci√≥n
          </a>
        </div>
      </div>
    </div>
  </main>

  <style>
    /* Estilos para los botones de modelo */
    .modelo-btn {
      @apply border-2 border-gray-300 rounded-lg p-3 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-gray-700;
    }
    .modelo-btn.active {
      @apply border-red-600 bg-red-50 text-red-600;
    }
    .modelo-btn svg {
      @apply text-current;
    }

    /* Estilos para botones de vista (frontal/trasera) */
    .vista-btn {
      @apply border-2 border-gray-300 bg-white hover:border-red-600 hover:bg-red-50 transition-all cursor-pointer text-gray-700;
    }
    .vista-btn.active {
      @apply border-red-600 bg-red-600 text-white shadow-lg;
    }
    .vista-btn:hover {
      @apply transform scale-105;
    }

    /* Estilos para botones de bolsillo y cierre */
    .bolsillo-btn,
    .cierre-btn {
      @apply border-2 border-gray-300 hover:border-red-600 hover:bg-red-50 transition-colors cursor-pointer text-gray-700;
    }
    .bolsillo-btn.active,
    .cierre-btn.active {
      @apply border-red-600 bg-red-100 text-red-700 font-bold;
    }

    /* Estilos para botones de tipo de prenda */
    .tipo-prenda-btn {
      @apply border-2 border-gray-300 bg-white hover:border-red-600 hover:bg-red-50 transition-all cursor-pointer text-gray-700;
    }
    .tipo-prenda-btn.active {
      @apply border-red-600 bg-red-50 text-red-600 font-bold;
    }
    .tipo-prenda-btn:hover {
      @apply transform scale-105;
    }

    /* Estilos para botones de tipo de cierre */
    .tipo-cierre-btn {
      @apply border-2 border-gray-300 bg-white hover:border-red-600 hover:bg-red-50 transition-all cursor-pointer text-gray-700;
    }
    .tipo-cierre-btn.active {
      @apply border-red-600 bg-red-50 text-red-600 font-bold;
    }
    .tipo-cierre-btn:hover {
      @apply transform scale-105;
    }

    /* Estilo para la l√≠nea del cierre */
    .linea-cierre {
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    /* Las partes del poler√≥n ya no tienen efectos hover porque no son clickeables */
    .parte-poleron {
      transition: all 0.2s ease;
    }

    /* Estilos para el canvas unificado con drag entre vistas */
    [data-vista-container] {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Efecto de highlight cuando se arrastra sobre una vista */
    [data-vista-container].ring-2 {
      box-shadow:
        0 0 0 2px currentColor,
        0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Animaci√≥n suave para cambio de vista */
    .overlay-elemento {
      transition: opacity 0.2s ease-in-out;
    }

    /* Mejora visual del canvas al arrastrar */
    #canvasUnificado > div {
      position: relative;
    }

    #canvasUnificado > div::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 0.5rem;
      pointer-events: none;
      transition: all 0.3s ease;
      opacity: 0;
    }

    [data-vista-container].ring-2::after {
      opacity: 1;
      background: radial-gradient(
        circle at center,
        transparent 40%,
        rgba(59, 130, 246, 0.05) 100%
      );
    }

    /* Mejoras para dispositivos t√°ctiles */
    @media (hover: none) and (pointer: coarse) {
      /* Aumentar √°rea t√°ctil de los controles SVG */
      .handle-resize,
      .handle-rotate {
        r: 10 !important; /* Aumentar radio en m√≥vil */
      }

      /* Hacer los botones de texto m√°s grandes en m√≥vil */
      .boton-eliminar-texto,
      .boton-editar-texto,
      .boton-rotar-texto {
        width: 28px !important;
        height: 28px !important;
        font-size: 18px !important;
      }

      /* Aumentar tama√±o del bot√≥n de eliminar en SVG */
      .boton-eliminar circle {
        r: 12 !important;
      }

      /* Mejorar feedback visual al tocar */
      .overlay-elemento {
        touch-action: pan-y;
        -webkit-user-select: none;
        user-select: none;
      }

      /* Permitir scroll en los contenedores de vista */
      [data-vista-container] {
        touch-action: pan-y;
      }

      /* Prevenir zoom al hacer doble tap en elementos editables, pero permitir scroll */
      svg {
        touch-action: pan-x pan-y;
      }

      foreignObject {
        touch-action: pan-y;
      }
    }

    /* Prevenir comportamiento de arrastre del navegador */
    svg image,
    .overlay-elemento {
      -webkit-user-drag: none;
      -khtml-user-drag: none;
      -moz-user-drag: none;
      -o-user-drag: none;
      user-drag: none;
    }
  </style>

  <script>
    // @ts-nocheck
    import { Picker } from "emoji-mart";
    import data from "@emoji-mart/data";

    // Estado global
    interface ImagenOverlay {
      id: string;
      src: string;
      x: number;
      y: number;
      width: number;
      height: number;
      rotation: number;
      zIndex: number;
      vista: "frontal" | "trasera"; // Nueva propiedad para vista
    }

    interface TextoOverlay {
      id: string;
      texto: string;
      fuente: string;
      color: string;
      size: number;
      x: number;
      y: number;
      rotation: number;
      zIndex: number;
      vista: "frontal" | "trasera"; // Nueva propiedad para vista
    }

    interface EstadoDiseno {
      modelo: string;
      parteActual: string;
      colores: Record<string, string>;
      imagenes: ImagenOverlay[];
      textos: TextoOverlay[];
      vistaActual: "frontal" | "trasera"; // Controla qu√© vista est√° activa
      tipoPrenda: "poleron" | "cortaviento"; // Tipo de prenda (solo para modelos 3 y 4)
      tipoCierre: "solo-cierre" | "cierre-broche"; // Tipo de cierre (para modelos 1-4)
    }
    // Colores por defecto para cada modelo
    const coloresPorModelo: Record<string, Record<string, string>> = {
      "modelo-1": {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#FFFFFF",
        pu√±os: "#FFFFFF",
        "gorro-externo": "#FFFFFF",
        "gorro-interno": "#B0B0B0", // Gris Melange
        bolsillo: "#FFFFFF",
      },
      "modelo-2": {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#000000",
      },
      "modelo-3": {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#FFFFFF",
        "rayas-pretina": "#000000",
      },
      "modelo-4": {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#FFFFFF",
        pu√±os: "#FFFFFF",
        "gorro-externo": "#FFFFFF",
        "gorro-interno": "#B0B0B0", // Gris Melange
        pretina: "#FFFFFF",
        "rayas-pretina": "#000000",
      },
      "modelo-5": {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#FFFFFF",
        pu√±os: "#FFFFFF",
        "gorro-externo": "#FFFFFF",
        "gorro-interno": "#B0B0B0", // Gris Melange
        bolsillo: "#FFFFFF",
        "borde-bolsillo": "#000000",
      },
    };

    // Funci√≥n para obtener colores iniciales del modelo actual
    function obtenerColoresModelo(modelo: string): Record<string, string> {
      return coloresPorModelo[modelo] ? { ...coloresPorModelo[modelo] } : {};
    }

    // Mapa de colores hexadecimales a nombres descriptivos
    const nombresColores: Record<string, string> = {
      "#FFFFFF": "Blanco",
      "#000000": "Negro",
      "#FF00FF": "Fuxia",
      "#2E5090": "Calipso",
      "#318CE7": "Azul Francia",
      "#FFFDD0": "Crema",
      "#FFDB58": "Mostaza",
      "#C8A2C8": "Lila",
      "#E6E6FA": "Lila/Lavanda",
      "#800080": "P√∫rpura",
      "#9370DB": "Morado",
      "#145A32": "Verde Petr√≥leo",
      "#1B4F72": "Azul Petr√≥leo",
      "#D62828": "Rojo Italiano",
      "#FFC0CB": "Rosado",
      "#E7B8B8": "Rosado Palo de Rosa",
      "#F5F5DC": "Beige",
      "#B0B0B0": "Gris Melange",
      "#4A4A4A": "Gris Marengo",
      "#88B04B": "Verde Cata",
      "#4169E1": "Azul Rey",
      "#800020": "Burdeo",
      "#006A4E": "Verde Botella",
      "#87CEEB": "Celeste",
      "#50C878": "Verde Turquesa/Esmeralda",
      "#00A86B": "Verde Jade",
    };

    // Funci√≥n para obtener el nombre del color desde su c√≥digo hexadecimal
    function obtenerNombreColor(hex: string): string {
      // Normalizar el formato del color
      const normalizado = hex.toUpperCase();

      // Si existe en el mapa, devolver el nombre
      if (nombresColores[normalizado]) {
        return nombresColores[normalizado];
      }

      // Si no existe, devolver el c√≥digo hexadecimal
      return hex;
    }

    const estadoDiseno: EstadoDiseno = {
      modelo: "modelo-1",
      parteActual: "cuerpo",
      colores: obtenerColoresModelo("modelo-1"),
      imagenes: [],
      textos: [],
      vistaActual: "frontal", // Vista inicial
      tipoPrenda: "poleron", // Tipo de prenda por defecto
      tipoCierre: "cierre-broche", // Tipo de cierre por defecto
    };

    const emojiRegex = /[\p{Extended_Pictographic}]/u;
    function contieneEmoji(texto: string) {
      return emojiRegex.test(texto);
    }

    // Variables para el elemento seleccionado actualmente
    let elementoSeleccionado: { tipo: "imagen" | "texto"; id: string } | null =
      null;
    let modoInteraccion: "drag" | "resize" | "rotate" | null = null;
    let startMouseX = 0;
    let startMouseY = 0;
    let startElementX = 0;
    let startElementY = 0;
    let startElementWidth = 0;
    let startElementHeight = 0;
    let startElementRotation = 0;
    let lastClientX = 0;
    let lastClientY = 0;
    let textoEnEdicionId: string | null = null;

    // Mapas para referencias DOM
    const elementosImagenDOM = new Map<string, SVGGElement>();
    const elementosTextoDOM = new Map<
      string,
      { foreign: SVGForeignObjectElement; container: HTMLElement }
    >();

    function actualizarInfoDiseno() {
      const cfg = modelosConfig[estadoDiseno.modelo];
      if (infoModelo)
        infoModelo.textContent = cfg?.nombre || estadoDiseno.modelo;
      if (infoParte)
        infoParte.textContent =
          nombresPartes[estadoDiseno.parteActual] || estadoDiseno.parteActual;

      // Mostrar/ocultar tipo de prenda seg√∫n el modelo
      const mostrarTipoPrenda =
        estadoDiseno.modelo === "modelo-3" ||
        estadoDiseno.modelo === "modelo-4";
      if (infoTipoPrenda && infoTipoPrendaLabel) {
        infoTipoPrenda.style.display = mostrarTipoPrenda ? "block" : "none";
        infoTipoPrendaLabel.style.display = mostrarTipoPrenda
          ? "block"
          : "none";
        if (mostrarTipoPrenda) {
          infoTipoPrenda.textContent =
            estadoDiseno.tipoPrenda === "poleron" ? "Poler√≥n" : "Cortaviento";
        }
      }

      // Mostrar/ocultar tipo de cierre seg√∫n el modelo
      const mostrarTipoCierre =
        estadoDiseno.modelo === "modelo-1" ||
        estadoDiseno.modelo === "modelo-2" ||
        estadoDiseno.modelo === "modelo-3" ||
        estadoDiseno.modelo === "modelo-4";
      if (infoTipoCierre && infoTipoCierreLabel) {
        infoTipoCierre.style.display = mostrarTipoCierre ? "block" : "none";
        infoTipoCierreLabel.style.display = mostrarTipoCierre
          ? "block"
          : "none";
        if (mostrarTipoCierre) {
          infoTipoCierre.textContent =
            estadoDiseno.tipoCierre === "solo-cierre"
              ? "Solo Cierre"
              : "Cierre y Broche";
        }
      }

      if (infoColoresList) {
        infoColoresList.innerHTML = "";
        if (cfg?.partes?.length) {
          cfg.partes.forEach((parte) => {
            const li = document.createElement("li");
            li.className = "flex items-center justify-between gap-2";
            const nombre = document.createElement("span");
            nombre.textContent = nombresPartes[parte] || parte;
            const detalle = document.createElement("span");
            detalle.className = "flex items-center gap-2";
            const swatch = document.createElement("span");
            swatch.className = "w-4 h-4 rounded border border-gray-200";
            swatch.style.backgroundColor =
              estadoDiseno.colores[parte] || "#fff";
            const valor = document.createElement("span");
            valor.className = "font-semibold text-xs";
            const colorHex = estadoDiseno.colores[parte] || "-";
            const nombreColor =
              colorHex !== "-" ? obtenerNombreColor(colorHex) : "-";
            valor.textContent = nombreColor;
            detalle.appendChild(swatch);
            detalle.appendChild(valor);
            li.appendChild(nombre);
            li.appendChild(detalle);
            infoColoresList.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.className = "text-gray-500";
          li.textContent = "Sin datos";
          infoColoresList.appendChild(li);
        }
      }

      if (infoTextosList) {
        infoTextosList.innerHTML = "";
        if (estadoDiseno.textos.length === 0) {
          const li = document.createElement("li");
          li.className = "py-2 px-3 text-gray-500";
          li.textContent = "Sin textos";
          infoTextosList.appendChild(li);
        } else {
          estadoDiseno.textos.forEach((txt, idx) => {
            const li = document.createElement("li");
            li.className = "py-2 px-3 space-y-1";
            const titulo = document.createElement("div");
            titulo.className = "font-semibold text-gray-800 truncate";
            titulo.textContent = `${idx + 1}. "${txt.texto}"`;
            const meta = document.createElement("div");
            meta.className = "text-[11px] text-gray-600";
            meta.textContent = `Posici√≥n: (${Math.round(txt.x)}, ${Math.round(
              txt.y,
            )}) ‚Ä¢ Tama√±o: ${txt.size}px`;
            const meta2 = document.createElement("div");
            meta2.className = "text-[11px] text-gray-600";
            meta2.textContent = `Rotaci√≥n: ${Math.round(txt.rotation)}¬∞`;
            li.appendChild(titulo);
            li.appendChild(meta);
            li.appendChild(meta2);
            infoTextosList.appendChild(li);
          });
        }
      }

      if (infoImagenesInfo) {
        infoImagenesInfo.innerHTML = "";
        const total = document.createElement("div");
        total.className = "font-semibold text-gray-800";
        total.textContent = `Cantidad: ${estadoDiseno.imagenes.length}`;
        infoImagenesInfo.appendChild(total);

        if (estadoDiseno.imagenes.length === 0) {
          const vacio = document.createElement("div");
          vacio.className = "text-gray-500";
          vacio.textContent = "Sin im√°genes";
          infoImagenesInfo.appendChild(vacio);
        } else {
          estadoDiseno.imagenes.forEach((img, idx) => {
            const item = document.createElement("div");
            item.className =
              "p-2 rounded border border-gray-100 bg-white text-gray-700";
            const titulo = document.createElement("div");
            titulo.className = "font-semibold text-xs";
            titulo.textContent = `Imagen ${idx + 1}`;
            const detalle = document.createElement("div");
            detalle.className = "text-[11px] text-gray-600";
            detalle.textContent = `Posici√≥n: (${Math.round(
              img.x,
            )}, ${Math.round(img.y)}) ‚Ä¢ Tama√±o: ${Math.round(
              img.width,
            )}x${Math.round(img.height)} px ‚Ä¢ Rotaci√≥n: ${Math.round(
              img.rotation,
            )}¬∞`;
            item.appendChild(titulo);
            item.appendChild(detalle);
            infoImagenesInfo.appendChild(item);
          });
        }
      }

      if (infoTieneEmoji) {
        const hayEmoji = estadoDiseno.textos.some((t) =>
          contieneEmoji(t.texto),
        );
        infoTieneEmoji.textContent = hayEmoji ? "Verdadero" : "Falso";
        infoTieneEmoji.className = `px-2 py-1 rounded-full font-semibold ${
          hayEmoji ? "bg-green-100 text-green-700" : "bg-gray-100 text-gray-700"
        }`;
      }
    }

    // En mobile movemos el canvas debajo del selector de modelo
    const panelControl = document.getElementById("panelControl");
    const selectorModeloBloque = document.getElementById(
      "selectorModeloBloque",
    );
    const canvasDiseno = document.getElementById("canvasDiseno");
    const canvasPadreOriginal = canvasDiseno?.parentElement ?? null;
    const canvasHermano = canvasDiseno?.nextElementSibling ?? null;
    const vistaMobile = window.matchMedia("(max-width: 1023px)");

    const acomodarCanvas = () => {
      if (
        !panelControl ||
        !selectorModeloBloque ||
        !canvasDiseno ||
        !canvasPadreOriginal
      ) {
        return;
      }

      if (vistaMobile.matches) {
        if (canvasDiseno.parentElement !== panelControl) {
          selectorModeloBloque.insertAdjacentElement("afterend", canvasDiseno);
        }
      } else if (canvasDiseno.parentElement !== canvasPadreOriginal) {
        canvasPadreOriginal.insertBefore(canvasDiseno, canvasHermano);
      }
    };
    // Modelos
    const modelosConfig: Record<
      string,
      {
        nombre: string;
        tieneGorro: boolean;
        frenteId: string;
        espaldaId: string;
        partes: string[];
      }
    > = {
      "modelo-1": {
        nombre: "Canguro con cierre",
        tieneGorro: true,
        frenteId: "modelo1Frente",
        espaldaId: "modelo1Espalda",
        partes: [
          "cuerpo",
          "mangas",
          "cintura",
          "pu√±os",
          "gorro-externo",
          "gorro-interno",
          "bolsillo",
          "borde-bolsillo",
        ],
      },
      "modelo-2": {
        nombre: "Modelo 2",
        tieneGorro: false,
        frenteId: "modelo2Frente",
        espaldaId: "modelo2Espalda",
        partes: ["cuerpo", "mangas", "cintura"],
      },
      "modelo-3": {
        nombre: "Americano b√°sico",
        tieneGorro: false,
        frenteId: "modelo3Frente",
        espaldaId: "modelo3Espalda",
        partes: ["cuerpo", "mangas", "cintura", "rayas-pretina"],
      },
      "modelo-4": {
        nombre: "Americano con gorro",
        tieneGorro: true,
        frenteId: "modelo4Frente",
        espaldaId: "modelo4Espalda",
        partes: [
          "cuerpo",
          "mangas",
          "cintura",
          "pu√±os",
          "gorro-externo",
          "gorro-interno",
          "pretina",
          "rayas-pretina",
          "borde-bolsillo",
        ],
      },
      "modelo-5": {
        nombre: "Canguro",
        tieneGorro: true,
        frenteId: "modelo5Frente",
        espaldaId: "modelo5Espalda",
        partes: [
          "cuerpo",
          "mangas",
          "cintura",
          "pu√±os",
          "gorro-externo",
          "gorro-interno",
          "bolsillo",
          "borde-bolsillo",
        ],
      },
    };

    // Elementos
    const parteSelect = document.getElementById(
      "parteSelect",
    ) as HTMLSelectElement;
    const colorCustomInput = document.getElementById(
      "colorCustom",
    ) as HTMLInputElement;
    const btnGuardar = document.getElementById("btnGuardar");
    const btnWhatsApp = document.getElementById("btnWhatsApp");
    const btnReset = document.getElementById("btnReset");
    const btnAgregarImagen = document.getElementById("btnAgregarImagen");
    const inputImagen = document.getElementById(
      "inputImagen",
    ) as HTMLInputElement;
    const infoModelo = document.getElementById("infoModelo");
    const infoParte = document.getElementById("infoParte");
    const infoTipoPrenda = document.getElementById("infoTipoPrenda");
    const infoTipoPrendaLabel = document.getElementById("infoTipoPrendaLabel");
    const infoTipoCierre = document.getElementById("infoTipoCierre");
    const infoTipoCierreLabel = document.getElementById("infoTipoCierreLabel");
    const infoColoresList = document.getElementById("infoColores");
    const infoTextosList = document.getElementById("infoTextos");
    const infoImagenesInfo = document.getElementById("infoImagenes");
    const infoTieneEmoji = document.getElementById("infoTieneEmoji");
    const textoInput = document.getElementById(
      "textoInput",
    ) as HTMLInputElement;
    const textoColor = document.getElementById(
      "textoColor",
    ) as HTMLInputElement;
    const textoSize = document.getElementById("textoSize") as HTMLInputElement;
    const btnAgregarTexto = document.getElementById("btnAgregarTexto");

    // Nombres legibles para las partes
    const nombresPartes: Record<string, string> = {
      cuerpo: "Cuerpo",
      mangas: "Mangas",
      cintura: "Cintura",
      pu√±os: "Pu√±os",
      "gorro-externo": "Gorro Externo",
      "gorro-interno": "Gorro Interno/Forro",
      bolsillo: "Bolsillo",
      pretina: "Pretina",
      "rayas-pretina": "Rayas de Pretina",
      "borde-bolsillo": "Borde de Bolsillo",
    };

    // Actualizar selector de partes seg√∫n el modelo
    function actualizarSelectorPartes(modelo: string) {
      const cfg = modelosConfig[modelo];
      parteSelect.innerHTML = "";

      cfg.partes.forEach((parte) => {
        const option = document.createElement("option");
        option.value = parte;
        option.textContent = nombresPartes[parte] || parte;
        parteSelect.appendChild(option);
      });

      // Seleccionar la primera parte disponible
      if (cfg.partes.length > 0) {
        estadoDiseno.parteActual = cfg.partes[0];
        parteSelect.value = cfg.partes[0];
        if (infoParte)
          infoParte.textContent = nombresPartes[cfg.partes[0]] || cfg.partes[0];
      }
    }

    function actualizarModelo(modelo: string) {
      estadoDiseno.modelo = modelo;

      // Reiniciar colores seg√∫n el modelo seleccionado
      estadoDiseno.colores = obtenerColoresModelo(modelo);

      document
        .querySelectorAll(".modelo-btn")
        .forEach((b) =>
          b.classList.toggle(
            "active",
            (b as HTMLElement).dataset.modelo === modelo,
          ),
        );
      Object.values(modelosConfig).forEach((cfg) => {
        document.getElementById(cfg.frenteId)?.classList.add("hidden");
        document.getElementById(cfg.espaldaId)?.classList.add("hidden");
      });
      const cfg = modelosConfig[modelo];
      document.getElementById(cfg.frenteId)?.classList.remove("hidden");
      document.getElementById(cfg.espaldaId)?.classList.remove("hidden");
      const gorroPartes = document.querySelectorAll(
        '[data-parte="gorro-externo"],[data-parte="gorro-interno"]',
      );
      gorroPartes.forEach((el) =>
        el.classList.toggle("hidden", !cfg.tieneGorro),
      );

      // Mostrar/ocultar selector de tipo de prenda seg√∫n el modelo
      const selectorTipoPrenda = document.getElementById("selectorTipoPrenda");
      if (selectorTipoPrenda) {
        if (modelo === "modelo-3" || modelo === "modelo-4") {
          selectorTipoPrenda.style.display = "block";
        } else {
          selectorTipoPrenda.style.display = "none";
          // Resetear a poler√≥n cuando se oculta
          estadoDiseno.tipoPrenda = "poleron";
        }
      }

      // Mostrar/ocultar selector de tipo de cierre seg√∫n el modelo
      const selectorTipoCierre = document.getElementById("selectorTipoCierre");
      if (selectorTipoCierre) {
        if (
          modelo === "modelo-1" ||
          modelo === "modelo-2" ||
          modelo === "modelo-3" ||
          modelo === "modelo-4"
        ) {
          selectorTipoCierre.style.display = "block";
        } else {
          selectorTipoCierre.style.display = "none";
          // Resetear a cierre-broche cuando se oculta
          estadoDiseno.tipoCierre = "cierre-broche";
        }
      }

      // Actualizar selector de partes din√°micamente
      actualizarSelectorPartes(modelo);

      actualizarColores();
      actualizarLineaCierre(); // Actualizar l√≠nea del cierre
      actualizarOverlays();
      if (infoModelo) infoModelo.textContent = cfg.nombre;
      actualizarInfoDiseno();
    }

    function actualizarColores() {
      const cfg = modelosConfig[estadoDiseno.modelo];
      const frenteSvg = document.getElementById(cfg.frenteId);
      const espaldaSvg = document.getElementById(cfg.espaldaId);

      // Solo actualizar partes que existen en el modelo actual
      [frenteSvg, espaldaSvg].forEach((svg) => {
        svg?.querySelectorAll(".parte-poleron").forEach((el) => {
          const parte = el.getAttribute("data-parte");
          if (parte && estadoDiseno.colores[parte] !== undefined) {
            el.setAttribute("fill", estadoDiseno.colores[parte]);
          }
        });
      });
      actualizarInfoDiseno();
    }

    function actualizarLineaCierre() {
      const cfg = modelosConfig[estadoDiseno.modelo];
      const frenteSvg = document.getElementById(cfg.frenteId);

      if (!frenteSvg) return;

      // Remover l√≠nea existente si existe
      const lineaExistente = frenteSvg.querySelector(".linea-cierre");
      if (lineaExistente) {
        lineaExistente.remove();
      }

      // Solo agregar l√≠nea si es "solo-cierre" y el modelo es 1-4
      if (
        estadoDiseno.tipoCierre === "solo-cierre" &&
        ["modelo-1", "modelo-2", "modelo-3", "modelo-4"].includes(
          estadoDiseno.modelo,
        )
      ) {
        // Configuraciones espec√≠ficas por modelo para la posici√≥n de la l√≠nea
        const configuracionesCierre: Record<
          string,
          { startPercent: number; endPercent: number; rotation: number }
        > = {
          "modelo-1": { startPercent: 0.35, endPercent: 0.9, rotation: -0.3 }, // rotation: grados (positivo = derecha, negativo = izquierda)
          "modelo-2": { startPercent: 0.35, endPercent: 0.9, rotation: 0 },
          "modelo-3": { startPercent: 0.3, endPercent: 0.82, rotation: -0.3 },
          "modelo-4": { startPercent: 0.37, endPercent: 0.9, rotation: 0 },
        };

        const config = configuracionesCierre[estadoDiseno.modelo] || {
          startPercent: 0.15,
          endPercent: 0.75,
          rotation: 0,
        };

        // Obtener el viewBox del SVG para calcular las coordenadas
        const viewBox = frenteSvg.getAttribute("viewBox");
        let centerX = 300; // valor por defecto
        let startY = 100;
        let endY = 400;

        if (viewBox) {
          const [, , width, height] = viewBox.split(" ").map(Number);
          centerX = width / 2 + 4.5;
          startY = height * config.startPercent;
          endY = height * config.endPercent;
        }

        // Crear la l√≠nea del cierre
        const linea = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "line",
        );
        linea.setAttribute("class", "linea-cierre");
        linea.setAttribute("x1", centerX.toString());
        linea.setAttribute("y1", startY.toString());
        linea.setAttribute("x2", centerX.toString());
        linea.setAttribute("y2", endY.toString());
        linea.setAttribute("stroke", "#000000");
        linea.setAttribute("stroke-width", "6");
        linea.setAttribute("stroke-linecap", "round");
        linea.style.opacity = "0.8";

        // Aplicar rotaci√≥n si est√° configurada
        if (config.rotation !== 0) {
          // Calcular el punto medio de la l√≠nea para rotar desde el centro
          const centerY = (startY + endY) / 2;
          linea.setAttribute(
            "transform",
            `rotate(${config.rotation} ${centerX} ${centerY})`,
          );
        }

        // Agregar la l√≠nea al SVG (al final para que est√© encima)
        frenteSvg.appendChild(linea);
      }
    }

    function aplicarColor(color: string) {
      const parte = estadoDiseno.parteActual;
      estadoDiseno.colores[parte] = color;
      document
        .querySelectorAll(`[data-parte="${parte}"]`)
        .forEach((el) => el.setAttribute("fill", color));
      actualizarInfoDiseno();
    }

    parteSelect?.addEventListener("change", (e) => {
      const parteSeleccionada = (e.target as HTMLSelectElement).value;
      estadoDiseno.parteActual = parteSeleccionada;
      if (infoParte)
        infoParte.textContent =
          nombresPartes[parteSeleccionada] || parteSeleccionada;
      actualizarInfoDiseno();
    });

    colorCustomInput?.addEventListener("input", (e) =>
      aplicarColor((e.target as HTMLInputElement).value),
    );

    document.querySelectorAll(".color-preset").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const color = (e.currentTarget as HTMLElement).dataset.color;
        if (color) {
          aplicarColor(color);
          colorCustomInput.value = color;
        }
      });
    });

    document.querySelectorAll(".modelo-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const modelo =
          (e.currentTarget as HTMLElement).dataset.modelo || "modelo-1";
        actualizarModelo(modelo);
      });
    });

    // Event listeners para tipo de prenda
    document.querySelectorAll(".tipo-prenda-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const tipo = (e.currentTarget as HTMLElement).dataset.tipo || "poleron";
        estadoDiseno.tipoPrenda = tipo as "poleron" | "cortaviento";

        // Actualizar botones activos
        document
          .querySelectorAll(".tipo-prenda-btn")
          .forEach((b) =>
            b.classList.toggle(
              "active",
              (b as HTMLElement).dataset.tipo === tipo,
            ),
          );

        actualizarInfoDiseno();
      });
    });

    // Event listeners para tipo de cierre
    document.querySelectorAll(".tipo-cierre-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const cierre =
          (e.currentTarget as HTMLElement).dataset.cierre || "cierre-broche";
        estadoDiseno.tipoCierre = cierre as "solo-cierre" | "cierre-broche";

        // Actualizar botones activos
        document
          .querySelectorAll(".tipo-cierre-btn")
          .forEach((b) =>
            b.classList.toggle(
              "active",
              (b as HTMLElement).dataset.cierre === cierre,
            ),
          );

        // Actualizar l√≠nea del cierre
        actualizarLineaCierre();
        actualizarInfoDiseno();
      });
    });

    // Event listeners para clicks directamente en los SVGs (frente/espalda)
    // Funciones auxiliares para unificar eventos mouse y touch
    function obtenerPosicionEvento(e: MouseEvent | TouchEvent): {
      clientX: number;
      clientY: number;
    } {
      if ("touches" in e && e.touches.length > 0) {
        return {
          clientX: e.touches[0].clientX,
          clientY: e.touches[0].clientY,
        };
      } else if ("changedTouches" in e && e.changedTouches.length > 0) {
        return {
          clientX: e.changedTouches[0].clientX,
          clientY: e.changedTouches[0].clientY,
        };
      } else {
        return {
          clientX: (e as MouseEvent).clientX,
          clientY: (e as MouseEvent).clientY,
        };
      }
    }

    // Funci√≥n para detectar sobre qu√© vista (frente/espalda) est√° el mouse/touch
    function detectarVistaEnPosicion(
      clientX: number,
      clientY: number,
    ): "frontal" | "trasera" | null {
      const cfg = modelosConfig[estadoDiseno.modelo];
      const frenteSvg = document.getElementById(cfg.frenteId);
      const espaldaSvg = document.getElementById(cfg.espaldaId);

      if (!frenteSvg || !espaldaSvg) return null;

      const frenteRect = frenteSvg.getBoundingClientRect();
      const espaldaRect = espaldaSvg.getBoundingClientRect();

      // Verificar si el mouse est√° sobre el SVG del frente
      if (
        clientX >= frenteRect.left &&
        clientX <= frenteRect.right &&
        clientY >= frenteRect.top &&
        clientY <= frenteRect.bottom
      ) {
        return "frontal";
      }

      // Verificar si el mouse est√° sobre el SVG de la espalda
      if (
        clientX >= espaldaRect.left &&
        clientX <= espaldaRect.right &&
        clientY >= espaldaRect.top &&
        clientY <= espaldaRect.bottom
      ) {
        return "trasera";
      }

      return null;
    }

    // Funciones para manejar m√∫ltiples im√°genes
    function generarId(): string {
      return "id_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
    }

    btnAgregarImagen?.addEventListener("click", () => inputImagen?.click());
    inputImagen?.addEventListener("change", (e) => {
      const file = (e.target as HTMLInputElement).files?.[0];
      if (!file) return;
      if (file.size > 5 * 1024 * 1024) {
        alert("M√°x 5MB");
        return;
      }
      const reader = new FileReader();
      reader.onload = (ev) => {
        const nuevaImagen: ImagenOverlay = {
          id: generarId(),
          src: ev.target?.result as string,
          x: 100,
          y: 100,
          width: 100,
          height: 100,
          rotation: 0,
          zIndex: Date.now(),
          vista: estadoDiseno.vistaActual, // Asignar vista actual
        };
        estadoDiseno.imagenes.push(nuevaImagen);
        actualizarOverlays();
      };
      reader.readAsDataURL(file);
      (e.target as HTMLInputElement).value = "";
    });

    // Emoji Picker Logic
    const btnEmoji = document.getElementById("btnEmoji");
    const emojiPickerContainer = document.getElementById(
      "emojiPickerContainer",
    );
    const pickerRoot = document.getElementById("pickerRoot");
    let pickerInstance: any = null;

    async function initPicker() {
      // Wait for Picker and data to be loaded
      if (!Picker || !data) {
        console.warn("Emoji picker not ready yet");
        return;
      }

      if (pickerInstance) {
        if (pickerRoot) pickerRoot.innerHTML = ""; // Limpiar anterior
        pickerInstance = null;
      }

      if (pickerRoot) {
        pickerInstance = new Picker({
          data,
          onEmojiSelect: (emoji: any) => {
            if (textoInput) {
              textoInput.value += emoji.native;
              textoInput.focus();
            }
          },
          set: "native",
          locale: "es",
        });
        pickerRoot.appendChild(pickerInstance);
      }
    }

    btnEmoji?.addEventListener("click", (e) => {
      e.stopPropagation();
      emojiPickerContainer?.classList.toggle("hidden");

      if (!pickerInstance) {
        initPicker();
      }
    });

    // Cerrar picker al hacer click fuera
    document.addEventListener("click", (e) => {
      if (
        emojiPickerContainer &&
        !emojiPickerContainer.contains(e.target as Node) &&
        e.target !== btnEmoji
      ) {
        emojiPickerContainer.classList.add("hidden");
      }
    });

    // Funci√≥n para agregar o guardar edici√≥n de texto
    btnAgregarTexto?.addEventListener("click", () => {
      const texto = textoInput.value.trim();
      if (!texto) {
        alert("Por favor escribe un texto");
        return;
      }

      if (textoEnEdicionId) {
        const textoExistente = estadoDiseno.textos.find(
          (t) => t.id === textoEnEdicionId,
        );
        if (textoExistente) {
          textoExistente.texto = texto;
          textoExistente.fuente = "Arial, sans-serif";
          textoExistente.color = textoColor.value;
          textoExistente.size = parseInt(textoSize.value, 10);
        }
        textoEnEdicionId = null;
        elementoSeleccionado = null;
        limpiarEditorTexto();
        actualizarOverlays();
        return;
      }

      const nuevoTexto: TextoOverlay = {
        id: generarId(),
        texto,
        fuente: "Arial, sans-serif",
        color: textoColor.value,
        size: parseInt(textoSize.value, 10),
        x: 50,
        y: 80,
        rotation: 0,
        zIndex: Date.now(), // Usar timestamp como z-index inicial simple
        vista: estadoDiseno.vistaActual, // Asignar vista actual
      };
      estadoDiseno.textos.push(nuevoTexto);
      limpiarEditorTexto();
      actualizarOverlays();
    });

    // Listeners para vista previa en tiempo real durante edici√≥n
    const updateTextoSeleccionado = () => {
      if (textoEnEdicionId) {
        const texto = estadoDiseno.textos.find(
          (t) => t.id === textoEnEdicionId,
        );
        if (texto) {
          texto.texto = textoInput.value || texto.texto;
          texto.fuente = "Arial, sans-serif";
          texto.color = textoColor.value;
          texto.size = parseInt(textoSize.value, 10);
          actualizarOverlays();
        }
      }
    };

    textoInput?.addEventListener("input", updateTextoSeleccionado);
    textoColor?.addEventListener("input", updateTextoSeleccionado);
    textoSize?.addEventListener("input", updateTextoSeleccionado);

    // Funci√≥n principal para actualizar todos los overlays
    function actualizarOverlays() {
      // Limpiar overlays existentes y mapas
      document
        .querySelectorAll(".overlay-elemento")
        .forEach((el) => el.remove());
      elementosImagenDOM.clear();
      elementosTextoDOM.clear();

      const cfg = modelosConfig[estadoDiseno.modelo];
      const frenteSvg = document.getElementById(cfg.frenteId);
      const espaldaSvg = document.getElementById(cfg.espaldaId);
      if (!frenteSvg || !espaldaSvg) return;

      // Migrar elementos existentes sin propiedad vista (asignarles vista frontal)
      estadoDiseno.imagenes.forEach((img) => {
        if (!img.vista) img.vista = "frontal";
      });
      estadoDiseno.textos.forEach((txt) => {
        if (!txt.vista) txt.vista = "frontal";
      });

      // Renderizar TODOS los elementos (frente y espalda) en sus respectivos SVGs
      const imagenesFrente = estadoDiseno.imagenes.filter(
        (i) => (i.vista || "frontal") === "frontal",
      );
      const textosFrente = estadoDiseno.textos.filter(
        (t) => (t.vista || "frontal") === "frontal",
      );
      const imagenesEspalda = estadoDiseno.imagenes.filter(
        (i) => i.vista === "trasera",
      );
      const textosEspalda = estadoDiseno.textos.filter(
        (t) => t.vista === "trasera",
      );

      // Elementos del frente
      const elementosFrente = [
        ...imagenesFrente.map((i) => ({ ...i, tipo: "imagen" as const })),
        ...textosFrente.map((t) => ({ ...t, tipo: "texto" as const })),
      ].sort((a, b) => a.zIndex - b.zIndex);

      // Elementos de la espalda
      const elementosEspalda = [
        ...imagenesEspalda.map((i) => ({ ...i, tipo: "imagen" as const })),
        ...textosEspalda.map((t) => ({ ...t, tipo: "texto" as const })),
      ].sort((a, b) => a.zIndex - b.zIndex);

      // Renderizar elementos del frente en su SVG
      elementosFrente.forEach((el) => {
        if (el.tipo === "imagen") {
          crearImagenOverlay(el as ImagenOverlay, frenteSvg);
        } else {
          crearTextoOverlay(el as TextoOverlay, frenteSvg);
        }
      });

      // Renderizar elementos de la espalda en su SVG
      elementosEspalda.forEach((el) => {
        if (el.tipo === "imagen") {
          crearImagenOverlay(el as ImagenOverlay, espaldaSvg);
        } else {
          crearTextoOverlay(el as TextoOverlay, espaldaSvg);
        }
      });

      // Renderizar lista de capas
      renderizarCapas();
      actualizarInfoDiseno();
    }

    function renderizarCapas() {
      const contenedor = document.getElementById("listaCapas");
      if (!contenedor) return;
      contenedor.innerHTML = "";

      const todosElementos: Array<
        (ImagenOverlay | TextoOverlay) & { tipo: "imagen" | "texto" }
      > = [
        ...estadoDiseno.imagenes.map((i) => ({
          ...i,
          tipo: "imagen" as const,
        })),
        ...estadoDiseno.textos.map((t) => ({
          ...t,
          tipo: "texto" as const,
        })),
      ];

      if (todosElementos.length === 0) {
        contenedor.innerHTML =
          '<div class="text-center text-gray-500 text-sm py-4">No hay elementos agregados</div>';
        return;
      }

      // Ordenar por zIndex de mayor a menor (arriba = mayor z-index)
      // Para la lista visual, queremos el mayor z-index arriba
      todosElementos.sort((a, b) => b.zIndex - a.zIndex);

      let draggedElement: any = null;

      todosElementos.forEach((el) => {
        const div = document.createElement("div");
        div.className = `flex items-center justify-between p-2 rounded border cursor-move ${
          elementoSeleccionado?.id === el.id
            ? "border-red-500 bg-red-50"
            : "border-gray-200 hover:bg-gray-50"
        }`;
        div.draggable = true;
        div.setAttribute("data-elemento-id", el.id);

        // Drag & Drop eventos
        div.addEventListener("dragstart", (e) => {
          draggedElement = el;
          div.style.opacity = "0.5";
          if (e.dataTransfer) {
            e.dataTransfer.effectAllowed = "move";
          }
        });

        div.addEventListener("dragend", (e) => {
          div.style.opacity = "1";
          draggedElement = null;
        });

        div.addEventListener("dragover", (e) => {
          e.preventDefault();
          if (e.dataTransfer) {
            e.dataTransfer.dropEffect = "move";
          }
        });

        div.addEventListener("drop", (e) => {
          e.preventDefault();
          if (draggedElement && draggedElement.id !== el.id) {
            // Intercambiar z-index
            const tempZ = draggedElement.zIndex;
            draggedElement.zIndex = el.zIndex;
            el.zIndex = tempZ;

            // Actualizar el objeto original en el array correspondiente
            if (draggedElement.tipo === "imagen") {
              const img = estadoDiseno.imagenes.find(
                (i) => i.id === draggedElement.id,
              );
              if (img) img.zIndex = draggedElement.zIndex;
            } else {
              const txt = estadoDiseno.textos.find(
                (t) => t.id === draggedElement.id,
              );
              if (txt) txt.zIndex = draggedElement.zIndex;
            }

            if (el.tipo === "imagen") {
              const img = estadoDiseno.imagenes.find((i) => i.id === el.id);
              if (img) img.zIndex = el.zIndex;
            } else {
              const txt = estadoDiseno.textos.find((t) => t.id === el.id);
              if (txt) txt.zIndex = el.zIndex;
            }

            actualizarOverlays();
          }
        });

        const info = document.createElement("div");
        info.className = "flex items-center gap-2 cursor-pointer flex-1";
        info.onclick = () => seleccionarElemento(el.id, el.tipo);

        const icon = document.createElement("span");
        icon.textContent = el.tipo === "imagen" ? "üñºÔ∏è" : "T";

        const text = document.createElement("span");
        text.className = "text-sm font-medium truncate max-w-[120px]";
        if (el.tipo === "imagen") {
          const index = estadoDiseno.imagenes.findIndex((i) => i.id === el.id);
          text.textContent = `Imagen ${index + 1}`;
        } else {
          text.textContent = (el as any).texto;
        }

        // Badge de vista (Frente/Espalda)
        const vistaBadge = document.createElement("span");
        vistaBadge.className = `text-xs px-2 py-0.5 rounded ${
          el.vista === "frontal"
            ? "bg-blue-100 text-blue-700"
            : "bg-purple-100 text-purple-700"
        }`;
        vistaBadge.textContent = el.vista === "frontal" ? "Frente" : "Espalda";

        info.appendChild(icon);
        info.appendChild(text);
        info.appendChild(vistaBadge);

        const actions = document.createElement("div");
        actions.className = "flex gap-1";

        const btnDelete = document.createElement("button");
        btnDelete.className =
          "p-1 text-red-500 hover:bg-red-100 rounded transition-colors";
        btnDelete.innerHTML = "√ó";
        btnDelete.title = "Eliminar";
        btnDelete.onclick = (e) => {
          e.stopPropagation();
          eliminarElemento(el.id, el.tipo);
        };

        actions.appendChild(btnDelete);
        div.appendChild(info);
        div.appendChild(actions);
        contenedor.appendChild(div);
      });
    }

    function seleccionarElemento(id: string, tipo: "imagen" | "texto") {
      elementoSeleccionado = { id, tipo };
      modoInteraccion = null; // Resetear modo

      actualizarOverlays();
    }

    function cargarTextoEnEditor(id: string) {
      const texto = estadoDiseno.textos.find((t) => t.id === id);
      if (!texto) return;
      textoEnEdicionId = id;
      elementoSeleccionado = { tipo: "texto", id };
      // Cargar propiedades en los controles
      if (textoInput) textoInput.value = texto.texto;
      if (textoColor) textoColor.value = texto.color;
      if (textoSize) textoSize.value = texto.size.toString();
      // Expandir el panel "Agregar Imagen/Texto"
      const panelImagenTexto = document.querySelectorAll(".panel-header")[2]; // Tercer panel
      if (panelImagenTexto) {
        const content = panelImagenTexto.nextElementSibling as HTMLElement;
        const icon = panelImagenTexto.querySelector("span");
        if (content && content.classList.contains("hidden")) {
          content.classList.remove("hidden");
          if (icon) {
            icon.style.transform = "rotate(0deg)";
          }
        }
      }
      // Cambiar texto del bot√≥n
      if (btnAgregarTexto) {
        btnAgregarTexto.textContent = "Guardar edici√≥n";
      }
    }

    function limpiarEditorTexto() {
      // Limpiar campos
      if (textoInput) textoInput.value = "";
      if (textoColor) textoColor.value = "#000000";
      if (textoSize) textoSize.value = "32";
      textoEnEdicionId = null;
      // Cambiar bot√≥n de vuelta
      if (btnAgregarTexto) {
        btnAgregarTexto.textContent = "Agregar Texto";
      }
    }

    function eliminarElemento(id: string, tipo: "imagen" | "texto") {
      if (tipo === "imagen") {
        estadoDiseno.imagenes = estadoDiseno.imagenes.filter(
          (i) => i.id !== id,
        );
      } else {
        estadoDiseno.textos = estadoDiseno.textos.filter((t) => t.id !== id);
        if (textoEnEdicionId === id) {
          limpiarEditorTexto();
        }
      }
      if (elementoSeleccionado?.id === id) {
        elementoSeleccionado = null;
        // Limpiar editor si era un texto
        if (tipo === "texto") {
          limpiarEditorTexto();
        }
      }
      actualizarOverlays();
    }

    // Crear imagen overlay con controles
    function crearImagenOverlay(img: ImagenOverlay, svgParent: Element) {
      const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
      g.classList.add("overlay-elemento");
      g.setAttribute("data-id", img.id);
      g.setAttribute("data-tipo", "imagen");

      // Aplicar transformaci√≥n de rotaci√≥n en el centro de la imagen
      const centerX = img.x + img.width / 2;
      const centerY = img.y + img.height / 2;
      g.setAttribute(
        "transform",
        `rotate(${img.rotation} ${centerX} ${centerY})`,
      );

      // Imagen
      const image = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "image",
      );
      image.setAttribute("href", img.src);
      image.setAttribute("x", img.x.toString());
      image.setAttribute("y", img.y.toString());
      image.setAttribute("width", img.width.toString());
      image.setAttribute("height", img.height.toString());
      image.style.cursor = "move";
      image.style.pointerEvents = "all";

      // Borde de selecci√≥n (inicialmente oculto)
      const rect = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "rect",
      );
      rect.setAttribute("x", img.x.toString());
      rect.setAttribute("y", img.y.toString());
      rect.setAttribute("width", img.width.toString());
      rect.setAttribute("height", img.height.toString());
      rect.setAttribute("fill", "none");
      rect.setAttribute("stroke", "#3b82f6");
      rect.setAttribute("stroke-width", "2");
      rect.setAttribute("stroke-dasharray", "5,5");
      rect.classList.add("borde-seleccion");

      // Mostrar controles si est√° seleccionado
      if (
        elementoSeleccionado?.id === img.id &&
        elementoSeleccionado?.tipo === "imagen"
      ) {
        // Let actualizarSeleccionVisual handle this
        rect.style.display = "none";
      } else {
        rect.style.display = "none";
      }

      // Handle de redimensionamiento
      const handle = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "circle",
      );
      handle.setAttribute("cx", (img.x + img.width).toString());
      handle.setAttribute("cy", (img.y + img.height).toString());
      handle.setAttribute("r", "6");
      handle.setAttribute("fill", "#3b82f6");
      handle.setAttribute("stroke", "white");
      handle.setAttribute("stroke-width", "2");
      handle.style.cursor = "nwse-resize";
      handle.classList.add("handle-resize");
      handle.style.display = "none"; // Initially hidden

      // Handle de rotaci√≥n
      const rotateHandle = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "circle",
      );
      rotateHandle.setAttribute("cx", (img.x + img.width / 2).toString());
      rotateHandle.setAttribute("cy", (img.y - 15).toString());
      rotateHandle.setAttribute("r", "6");
      rotateHandle.setAttribute("fill", "#10b981");
      rotateHandle.setAttribute("stroke", "white");
      rotateHandle.setAttribute("stroke-width", "2");
      rotateHandle.style.cursor = "grab";
      rotateHandle.classList.add("handle-rotate");
      rotateHandle.style.display = "none"; // Initially hidden

      // L√≠nea del handle de rotaci√≥n
      const rotateLine = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "line",
      );
      rotateLine.setAttribute("x1", (img.x + img.width / 2).toString());
      rotateLine.setAttribute("y1", img.y.toString());
      rotateLine.setAttribute("x2", (img.x + img.width / 2).toString());
      rotateLine.setAttribute("y2", (img.y - 15).toString());
      rotateLine.setAttribute("stroke", "#10b981");
      rotateLine.setAttribute("stroke-width", "2");
      rotateLine.classList.add("line-rotate");
      rotateLine.style.display = "none"; // Initially hidden

      // Bot√≥n de eliminar
      const deleteBtn = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "g",
      );
      deleteBtn.classList.add("boton-eliminar");
      deleteBtn.style.cursor = "pointer";
      deleteBtn.style.display = "none";

      if (
        elementoSeleccionado?.id === img.id &&
        elementoSeleccionado?.tipo === "imagen"
      ) {
        deleteBtn.style.display = "block";
      }

      const deleteCircle = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "circle",
      );
      deleteCircle.setAttribute("cx", (img.x + img.width).toString());
      deleteCircle.setAttribute("cy", img.y.toString());
      deleteCircle.setAttribute("r", "8");
      deleteCircle.setAttribute("fill", "#ef4444");

      const deleteX = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "text",
      );
      deleteX.setAttribute("x", (img.x + img.width).toString());
      deleteX.setAttribute("y", img.y.toString());
      deleteX.setAttribute("text-anchor", "middle");
      deleteX.setAttribute("dominant-baseline", "central");
      deleteX.setAttribute("fill", "white");
      deleteX.setAttribute("font-size", "12");
      deleteX.setAttribute("font-weight", "bold");
      deleteX.textContent = "√ó";

      deleteBtn.appendChild(deleteCircle);
      deleteBtn.appendChild(deleteX);

      g.appendChild(image);
      g.appendChild(rect);
      g.appendChild(rotateLine);
      g.appendChild(rotateHandle);
      g.appendChild(handle);
      g.appendChild(deleteBtn);

      // Event listeners para imagen (mouse y touch)
      const handleImageStart = (e: MouseEvent | TouchEvent) => {
        e.stopPropagation();
        // Prevenir scroll solo cuando se toca una imagen
        if ("touches" in e) {
          e.preventDefault();
        }
        modoInteraccion = "drag";
        elementoSeleccionado = { tipo: "imagen", id: img.id };
        actualizarSeleccionVisual();

        const pos = obtenerPosicionEvento(e);
        const rect = svgParent.getBoundingClientRect();
        const scaleX = 300 / rect.width;
        const scaleY = 400 / rect.height;

        // Calcular posici√≥n del mouse/touch en coordenadas del SVG
        const mouseX = (pos.clientX - rect.left) * scaleX;
        const mouseY = (pos.clientY - rect.top) * scaleY;

        // Guardar el offset entre el click y la posici√≥n de la imagen
        startMouseX = mouseX;
        startMouseY = mouseY;
        startElementX = img.x;
        startElementY = img.y;

        lastClientX = pos.clientX;
        lastClientY = pos.clientY;
      };

      image.addEventListener("mousedown", handleImageStart);
      image.addEventListener("touchstart", handleImageStart, {
        passive: false,
      });

      // Event listeners para handle de resize (mouse y touch)
      const handleResizeStart = (e: MouseEvent | TouchEvent) => {
        e.stopPropagation();
        // Prevenir scroll solo cuando se toca el handle de resize
        if ("touches" in e) {
          e.preventDefault();
        }
        modoInteraccion = "resize";
        elementoSeleccionado = { tipo: "imagen", id: img.id };

        const pos = obtenerPosicionEvento(e);
        const rect = svgParent.getBoundingClientRect();
        const scaleX = 300 / rect.width;
        const scaleY = 400 / rect.height;

        startMouseX = (pos.clientX - rect.left) * scaleX;
        startMouseY = (pos.clientY - rect.top) * scaleY;
        startElementWidth = img.width;
        startElementHeight = img.height;
      };

      handle.addEventListener("mousedown", handleResizeStart);
      handle.addEventListener("touchstart", handleResizeStart, {
        passive: false,
      });

      // Event listeners para handle de rotaci√≥n (mouse y touch)
      const handleRotateStart = (e: MouseEvent | TouchEvent) => {
        e.stopPropagation();
        // Prevenir scroll solo cuando se toca el handle de rotaci√≥n
        if ("touches" in e) {
          e.preventDefault();
        }
        modoInteraccion = "rotate";
        elementoSeleccionado = { tipo: "imagen", id: img.id };
        startElementRotation = img.rotation;
        rotateHandle.style.cursor = "grabbing";
      };

      rotateHandle.addEventListener("mousedown", handleRotateStart);
      rotateHandle.addEventListener("touchstart", handleRotateStart, {
        passive: false,
      });

      deleteBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        estadoDiseno.imagenes = estadoDiseno.imagenes.filter(
          (i) => i.id !== img.id,
        );
        actualizarOverlays();
      });

      elementosImagenDOM.set(img.id, g);
      svgParent.appendChild(g);
    }

    function actualizarPosicionImagen(g: SVGGElement, img: ImagenOverlay) {
      const image = g.querySelector("image");
      const rect = g.querySelector(".borde-seleccion");
      const handle = g.querySelector(".handle-resize");
      const rotateHandle = g.querySelector(".handle-rotate");
      const rotateLine = g.querySelector(".line-rotate");
      const deleteBtn = g.querySelector(".boton-eliminar");

      // Actualizar transformaci√≥n de rotaci√≥n
      const centerX = img.x + img.width / 2;
      const centerY = img.y + img.height / 2;
      g.setAttribute(
        "transform",
        `rotate(${img.rotation} ${centerX} ${centerY})`,
      );

      if (image) {
        image.setAttribute("x", img.x.toString());
        image.setAttribute("y", img.y.toString());
        image.setAttribute("width", img.width.toString());
        image.setAttribute("height", img.height.toString());
      }
      if (rect) {
        rect.setAttribute("x", img.x.toString());
        rect.setAttribute("y", img.y.toString());
        rect.setAttribute("width", img.width.toString());
        rect.setAttribute("height", img.height.toString());
      }
      if (handle) {
        handle.setAttribute("cx", (img.x + img.width).toString());
        handle.setAttribute("cy", (img.y + img.height).toString());
      }
      if (rotateHandle) {
        rotateHandle.setAttribute("cx", (img.x + img.width / 2).toString());
        rotateHandle.setAttribute("cy", (img.y - 15).toString());
      }
      if (rotateLine) {
        rotateLine.setAttribute("x1", (img.x + img.width / 2).toString());
        rotateLine.setAttribute("y1", img.y.toString());
        rotateLine.setAttribute("x2", (img.x + img.width / 2).toString());
        rotateLine.setAttribute("y2", (img.y - 15).toString());
      }
      if (deleteBtn) {
        const circle = deleteBtn.querySelector("circle");
        const text = deleteBtn.querySelector("text");
        if (circle) circle.setAttribute("cx", (img.x + img.width).toString());
        if (circle) circle.setAttribute("cy", img.y.toString());
        if (text) text.setAttribute("x", (img.x + img.width).toString());
        if (text) text.setAttribute("y", img.y.toString());
      }
    }

    // Crear texto overlay con controles
    function crearTextoOverlay(txt: TextoOverlay, svgParent: Element) {
      const foreign = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "foreignObject",
      );
      foreign.setAttribute("x", "0");
      foreign.setAttribute("y", "0");
      foreign.setAttribute("width", "300");
      foreign.setAttribute("height", "400");
      foreign.classList.add("overlay-elemento");
      foreign.setAttribute("data-id", txt.id);
      foreign.setAttribute("data-tipo", "texto");
      foreign.style.pointerEvents = "none"; // Permitir clicks a trav√©s del contenedor

      const container = document.createElement("div");
      container.setAttribute("xmlns", "http://www.w3.org/1999/xhtml");
      container.style.position = "absolute";
      container.style.left = txt.x + "px";
      container.style.top = txt.y + "px";
      container.style.fontFamily = txt.fuente;
      container.style.color = txt.color;
      container.style.fontSize = txt.size + "px";
      container.style.fontWeight = "700";
      container.style.cursor = "move";
      container.style.userSelect = "none";
      container.style.padding = "4px";
      container.style.display = "inline-block";
      container.style.pointerEvents = "auto"; // Reactivar eventos para el texto
      container.style.transform = `rotate(${txt.rotation}deg)`;
      container.style.transformOrigin = "center center";
      container.textContent = "";
      const textSpan = document.createElement("span");
      textSpan.textContent = txt.texto;
      textSpan.style.display = "inline-block";
      container.appendChild(textSpan);

      // Borde y bot√≥n de eliminar
      const controls = document.createElement("div");
      controls.style.position = "absolute";
      controls.style.top = "-2px";
      controls.style.left = "-2px";
      controls.style.right = "-2px";
      controls.style.bottom = "-2px";
      controls.style.border = "2px dashed #3b82f6";
      controls.classList.add("controles-texto");

      if (
        elementoSeleccionado?.id === txt.id &&
        elementoSeleccionado?.tipo === "texto"
      ) {
        // Let actualizarSeleccionVisual handle this
        controls.style.display = "none";
      } else {
        controls.style.display = "none";
      }

      const deleteBtn = document.createElement("button");
      deleteBtn.innerHTML = "√ó";
      deleteBtn.style.position = "absolute";
      deleteBtn.style.top = "-10px";
      deleteBtn.style.right = "-10px";
      deleteBtn.style.width = "20px";
      deleteBtn.style.height = "20px";
      deleteBtn.style.borderRadius = "50%";
      deleteBtn.style.border = "none";
      deleteBtn.style.background = "#ef4444";
      deleteBtn.style.color = "white";
      deleteBtn.style.cursor = "pointer";
      deleteBtn.style.fontSize = "16px";
      deleteBtn.style.lineHeight = "1";
      deleteBtn.style.pointerEvents = "all";
      deleteBtn.style.display = "none"; // Initially hidden
      deleteBtn.classList.add("boton-eliminar-texto");

      const editBtn = document.createElement("button");
      editBtn.innerHTML = "E";
      editBtn.style.position = "absolute";
      editBtn.style.top = "-10px";
      editBtn.style.left = "-10px";
      editBtn.style.width = "20px";
      editBtn.style.height = "20px";
      editBtn.style.borderRadius = "50%";
      editBtn.style.border = "none";
      editBtn.style.background = "#3b82f6";
      editBtn.style.color = "white";
      editBtn.style.cursor = "pointer";
      editBtn.style.fontSize = "14px";
      editBtn.style.lineHeight = "1";
      editBtn.style.pointerEvents = "all";
      editBtn.style.display = "none"; // Initially hidden
      editBtn.classList.add("boton-editar-texto");

      const rotateBtn = document.createElement("button");
      rotateBtn.innerHTML = "‚Üª";
      rotateBtn.style.position = "absolute";
      rotateBtn.style.top = "-10px";
      rotateBtn.style.left = "50%";
      rotateBtn.style.transform = "translateX(-50%)";
      rotateBtn.style.width = "20px";
      rotateBtn.style.height = "20px";
      rotateBtn.style.borderRadius = "50%";
      rotateBtn.style.border = "none";
      rotateBtn.style.background = "#10b981";
      rotateBtn.style.color = "white";
      rotateBtn.style.cursor = "grab";
      rotateBtn.style.fontSize = "14px";
      rotateBtn.style.lineHeight = "1";
      rotateBtn.style.pointerEvents = "all";
      rotateBtn.style.display = "none"; // Initially hidden
      rotateBtn.classList.add("boton-rotar-texto");
      rotateBtn.classList.add("boton-rotar-texto");

      container.appendChild(controls);
      container.appendChild(deleteBtn);
      container.appendChild(editBtn);
      container.appendChild(rotateBtn);

      // Event listener para arrastrar texto (mouse y touch)
      const handleTextStart = (e: MouseEvent | TouchEvent) => {
        if ((e.target as HTMLElement).tagName === "BUTTON") return;
        e.stopPropagation();
        // Prevenir scroll solo cuando se toca un texto
        if ("touches" in e) {
          e.preventDefault();
        }
        modoInteraccion = "drag";
        elementoSeleccionado = { tipo: "texto", id: txt.id };
        actualizarSeleccionVisual();

        const pos = obtenerPosicionEvento(e);
        const rect = svgParent.getBoundingClientRect();
        const scaleX = 300 / rect.width;
        const scaleY = 400 / rect.height;

        // Calcular posici√≥n del mouse/touch en coordenadas del SVG
        const mouseX = (pos.clientX - rect.left) * scaleX;
        const mouseY = (pos.clientY - rect.top) * scaleY;

        // Guardar posici√≥n inicial
        startMouseX = mouseX;
        startMouseY = mouseY;
        startElementX = txt.x;
        startElementY = txt.y;

        lastClientX = pos.clientX;
        lastClientY = pos.clientY;
      };

      container.addEventListener("mousedown", handleTextStart);
      container.addEventListener("touchstart", handleTextStart, {
        passive: false,
      });

      deleteBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        estadoDiseno.textos = estadoDiseno.textos.filter(
          (t) => t.id !== txt.id,
        );
        if (textoEnEdicionId === txt.id) {
          limpiarEditorTexto();
        }
        if (elementoSeleccionado?.id === txt.id) {
          elementoSeleccionado = null;
        }
        actualizarOverlays();
      });

      // Soporte touch para deleteBtn
      deleteBtn.addEventListener("touchend", (e) => {
        e.stopPropagation();
        e.preventDefault();
        estadoDiseno.textos = estadoDiseno.textos.filter(
          (t) => t.id !== txt.id,
        );
        if (textoEnEdicionId === txt.id) {
          limpiarEditorTexto();
        }
        if (elementoSeleccionado?.id === txt.id) {
          elementoSeleccionado = null;
        }
        actualizarOverlays();
      });

      editBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        cargarTextoEnEditor(txt.id);
        actualizarSeleccionVisual();
      });

      // Soporte touch para editBtn
      editBtn.addEventListener("touchend", (e) => {
        e.stopPropagation();
        e.preventDefault();
        cargarTextoEnEditor(txt.id);
        actualizarSeleccionVisual();
      });

      // Event listener para rotar texto (mouse y touch)
      const handleTextRotateStart = (e: MouseEvent | TouchEvent) => {
        e.stopPropagation();
        // Prevenir scroll solo cuando se toca el bot√≥n de rotaci√≥n
        if ("touches" in e) {
          e.preventDefault();
        }
        modoInteraccion = "rotate";
        elementoSeleccionado = { tipo: "texto", id: txt.id };
        startElementRotation = txt.rotation;
        rotateBtn.style.cursor = "grabbing";
      };

      rotateBtn.addEventListener("mousedown", handleTextRotateStart);
      rotateBtn.addEventListener("touchstart", handleTextRotateStart, {
        passive: false,
      });

      foreign.appendChild(container);
      elementosTextoDOM.set(txt.id, { foreign, container });
      svgParent.appendChild(foreign);
    }

    function actualizarSeleccionVisual() {
      // 1. Ocultar controles de IM√ÅGENES
      document
        .querySelectorAll(
          ".borde-seleccion, .handle-resize, .handle-rotate, .line-rotate, .boton-eliminar",
        )
        .forEach((el) => {
          (el as SVGElement).style.display = "none";
        });

      // 2. Ocultar controles de TEXTOS
      document
        .querySelectorAll(
          ".controles-texto, .boton-eliminar-texto, .boton-rotar-texto, .boton-editar-texto",
        )
        .forEach((el) => {
          (el as HTMLElement).style.display = "none";
        });

      // 3. Mostrar controles del elemento seleccionado
      if (elementoSeleccionado) {
        if (elementoSeleccionado.tipo === "imagen") {
          const g = elementosImagenDOM.get(elementoSeleccionado.id);
          if (g) {
            const rect = g.querySelector(".borde-seleccion") as SVGElement;
            const handle = g.querySelector(".handle-resize") as SVGElement;
            const rotateHandle = g.querySelector(
              ".handle-rotate",
            ) as SVGElement;
            const rotateLine = g.querySelector(".line-rotate") as SVGElement;
            const deleteBtn = g.querySelector(".boton-eliminar") as SVGElement;

            if (rect) rect.style.display = "block";
            if (handle) handle.style.display = "block";
            if (rotateHandle) rotateHandle.style.display = "block";
            if (rotateLine) rotateLine.style.display = "block";
            if (deleteBtn) deleteBtn.style.display = "block";
          }
        } else if (elementoSeleccionado.tipo === "texto") {
          const refs = elementosTextoDOM.get(elementoSeleccionado.id);
          if (refs) {
            const controls = refs.container.querySelector(
              ".controles-texto",
            ) as HTMLElement;
            const deleteBtn = refs.container.querySelector(
              ".boton-eliminar-texto",
            ) as HTMLElement;
            const editBtn = refs.container.querySelector(
              ".boton-editar-texto",
            ) as HTMLElement;
            const rotateBtn = refs.container.querySelector(
              ".boton-rotar-texto",
            ) as HTMLElement;

            if (controls) controls.style.display = "block";
            if (deleteBtn) deleteBtn.style.display = "block";
            if (editBtn) editBtn.style.display = "block";
            if (rotateBtn) rotateBtn.style.display = "block";
          }
        }
        renderizarCapas(); // Actualizar highlight en panel
      }
    }

    function mostrarControles(g: SVGGElement) {
      // Deprecated in favor of actualizarSeleccionVisual, but kept if needed or redirected
      actualizarSeleccionVisual();
    }

    // Handlers globales de mouse/touch para todas las interacciones
    const handleGlobalMove = (e: MouseEvent | TouchEvent) => {
      if (!elementoSeleccionado || !modoInteraccion) return;

      // Prevenir scroll solo cuando hay un elemento siendo arrastrado/manipulado
      if ("touches" in e) {
        e.preventDefault();
      }

      const pos = obtenerPosicionEvento(e);

      // Mostrar indicador visual de la vista sobre la que est√° el mouse/touch durante drag
      if (modoInteraccion === "drag") {
        const vistaDetectada = detectarVistaEnPosicion(
          pos.clientX,
          pos.clientY,
        );
        const contenedorFrente = document.querySelector(
          '[data-vista-container="frontal"]',
        ) as HTMLElement;
        const contenedorEspalda = document.querySelector(
          '[data-vista-container="trasera"]',
        ) as HTMLElement;

        // Remover highlight previo
        contenedorFrente?.classList.remove("ring-2", "ring-blue-400");
        contenedorEspalda?.classList.remove("ring-2", "ring-purple-400");

        // A√±adir highlight a la vista detectada
        if (vistaDetectada === "frontal") {
          contenedorFrente?.classList.add("ring-2", "ring-blue-400");
        } else if (vistaDetectada === "trasera") {
          contenedorEspalda?.classList.add("ring-2", "ring-purple-400");
        }
      }

      if (elementoSeleccionado.tipo === "imagen") {
        const img = estadoDiseno.imagenes.find(
          (i) => i.id === elementoSeleccionado!.id,
        );
        if (!img) return;

        const cfg = modelosConfig[estadoDiseno.modelo];
        // Usar el SVG correcto seg√∫n la vista del elemento
        const svgId = img.vista === "trasera" ? cfg.espaldaId : cfg.frenteId;
        const svgParent = document.getElementById(svgId);
        if (!svgParent) return;

        const rect = svgParent.getBoundingClientRect();
        const scaleX = 300 / rect.width;
        const scaleY = 400 / rect.height;
        const currentX = (pos.clientX - rect.left) * scaleX;
        const currentY = (pos.clientY - rect.top) * scaleY;

        const g = elementosImagenDOM.get(img.id);
        if (!g) return;

        if (modoInteraccion === "drag") {
          const deltaX = (pos.clientX - lastClientX) * scaleX;
          const deltaY = (pos.clientY - lastClientY) * scaleY;

          img.x = Math.max(0, Math.min(300 - img.width, img.x + deltaX));
          img.y = Math.max(0, Math.min(400 - img.height, img.y + deltaY));

          lastClientX = pos.clientX;
          lastClientY = pos.clientY;

          actualizarPosicionImagen(g, img);
        } else if (modoInteraccion === "resize") {
          const newWidth = Math.max(
            30,
            startElementWidth + (currentX - startMouseX),
          );
          const newHeight = Math.max(
            30,
            startElementHeight + (currentY - startMouseY),
          );
          img.width = Math.min(newWidth, 300 - img.x);
          img.height = Math.min(newHeight, 400 - img.y);
          actualizarPosicionImagen(g, img);
        } else if (modoInteraccion === "rotate") {
          const centerX = img.x + img.width / 2;
          const centerY = img.y + img.height / 2;
          const angle = Math.atan2(currentY - centerY, currentX - centerX);
          const degrees = angle * (180 / Math.PI) + 90;
          img.rotation = Math.round(degrees);
          actualizarPosicionImagen(g, img);
        }
      } else if (elementoSeleccionado.tipo === "texto") {
        const txt = estadoDiseno.textos.find(
          (t) => t.id === elementoSeleccionado!.id,
        );
        if (!txt) return;

        const cfg = modelosConfig[estadoDiseno.modelo];
        // Usar el SVG correcto seg√∫n la vista del elemento
        const svgId = txt.vista === "trasera" ? cfg.espaldaId : cfg.frenteId;
        const svgParent = document.getElementById(svgId);
        if (!svgParent) return;

        const refs = elementosTextoDOM.get(txt.id);
        if (!refs) return;
        const { foreign, container } = refs;

        if (modoInteraccion === "drag") {
          const rect = svgParent.getBoundingClientRect();
          const scaleX = 300 / rect.width;
          const scaleY = 400 / rect.height;

          const deltaX = (pos.clientX - lastClientX) * scaleX;
          const deltaY = (pos.clientY - lastClientY) * scaleY;

          txt.x = Math.max(0, Math.min(280, txt.x + deltaX));
          txt.y = Math.max(0, Math.min(380, txt.y + deltaY));

          lastClientX = pos.clientX;
          lastClientY = pos.clientY;

          container.style.left = txt.x + "px";
          container.style.top = txt.y + "px";
        } else if (modoInteraccion === "rotate") {
          const containerRect = container.getBoundingClientRect();
          const centerX = containerRect.left + containerRect.width / 2;
          const centerY = containerRect.top + containerRect.height / 2;
          const angle = Math.atan2(
            pos.clientY - centerY,
            pos.clientX - centerX,
          );
          const degrees = angle * (180 / Math.PI) + 90;
          txt.rotation = Math.round(degrees);
          container.style.transform = `rotate(${txt.rotation}deg)`;
        }
      }
    };

    document.addEventListener("mousemove", handleGlobalMove);
    document.addEventListener("touchmove", handleGlobalMove, {
      passive: false,
    });

    const handleGlobalEnd = (e: MouseEvent | TouchEvent) => {
      // Limpiar highlights visuales
      const contenedorFrente = document.querySelector(
        '[data-vista-container="frontal"]',
      ) as HTMLElement;
      const contenedorEspalda = document.querySelector(
        '[data-vista-container="trasera"]',
      ) as HTMLElement;
      contenedorFrente?.classList.remove("ring-2", "ring-blue-400");
      contenedorEspalda?.classList.remove("ring-2", "ring-purple-400");

      if (modoInteraccion === "drag" && elementoSeleccionado) {
        const pos = obtenerPosicionEvento(e);
        // Detectar sobre qu√© vista se solt√≥ el elemento
        const vistaDetectada = detectarVistaEnPosicion(
          pos.clientX,
          pos.clientY,
        );

        if (vistaDetectada) {
          // Cambiar la vista del elemento si es necesario
          if (elementoSeleccionado.tipo === "imagen") {
            const img = estadoDiseno.imagenes.find(
              (i) => i.id === elementoSeleccionado!.id,
            );
            if (img && img.vista !== vistaDetectada) {
              // Calcular la posici√≥n exacta del cursor en el nuevo SVG
              const cfg = modelosConfig[estadoDiseno.modelo];
              const nuevoSvgId =
                vistaDetectada === "trasera" ? cfg.espaldaId : cfg.frenteId;
              const nuevoSvg = document.getElementById(nuevoSvgId);

              if (nuevoSvg) {
                const rect = nuevoSvg.getBoundingClientRect();
                const scaleX = 300 / rect.width;
                const scaleY = 400 / rect.height;

                // Calcular coordenadas del cursor en el nuevo SVG
                const cursorX = (pos.clientX - rect.left) * scaleX;
                const cursorY = (pos.clientY - rect.top) * scaleY;

                // Centrar el elemento en la posici√≥n del cursor
                img.x = cursorX - img.width / 2;
                img.y = cursorY - img.height / 2;

                // Ajustar posici√≥n si est√° fuera de l√≠mites
                img.x = Math.max(0, Math.min(300 - img.width, img.x));
                img.y = Math.max(0, Math.min(400 - img.height, img.y));
              }

              img.vista = vistaDetectada;
              // Actualizar vista activa
              estadoDiseno.vistaActual = vistaDetectada;
              actualizarIndicadorVista();
              actualizarOverlays();
            }
          } else if (elementoSeleccionado.tipo === "texto") {
            const txt = estadoDiseno.textos.find(
              (t) => t.id === elementoSeleccionado!.id,
            );
            if (txt && txt.vista !== vistaDetectada) {
              // Calcular la posici√≥n exacta del cursor en el nuevo SVG
              const cfg = modelosConfig[estadoDiseno.modelo];
              const nuevoSvgId =
                vistaDetectada === "trasera" ? cfg.espaldaId : cfg.frenteId;
              const nuevoSvg = document.getElementById(nuevoSvgId);

              if (nuevoSvg) {
                const rect = nuevoSvg.getBoundingClientRect();
                const scaleX = 300 / rect.width;
                const scaleY = 400 / rect.height;

                // Calcular coordenadas del cursor en el nuevo SVG
                const cursorX = (pos.clientX - rect.left) * scaleX;
                const cursorY = (pos.clientY - rect.top) * scaleY;

                // Posicionar el texto en la posici√≥n del cursor
                // (el texto se posiciona desde su esquina superior izquierda)
                txt.x = cursorX;
                txt.y = cursorY;

                // Ajustar posici√≥n si est√° fuera de l√≠mites (con margen para el tama√±o del texto)
                txt.x = Math.max(0, Math.min(280, txt.x));
                txt.y = Math.max(txt.size, Math.min(380, txt.y));
              }

              txt.vista = vistaDetectada;
              // Actualizar vista activa
              estadoDiseno.vistaActual = vistaDetectada;
              actualizarIndicadorVista();
              actualizarOverlays();
            }
          }
        }
      }

      if (modoInteraccion === "rotate") {
        const rotateHandles = document.querySelectorAll(".handle-rotate");
        rotateHandles.forEach((h) => ((h as SVGElement).style.cursor = "grab"));
        const rotateBtns = document.querySelectorAll(".boton-rotar-texto");
        rotateBtns.forEach((b) => ((b as HTMLElement).style.cursor = "grab"));
      }
      modoInteraccion = null;
    };

    document.addEventListener("mouseup", handleGlobalEnd);
    document.addEventListener("touchend", handleGlobalEnd, { passive: true });

    // Click fuera para deseleccionar
    document.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;
      if (
        !target.closest(".overlay-elemento") &&
        !target.closest("#panelControl")
      ) {
        document
          .querySelectorAll(
            ".borde-seleccion, .handle-resize, .handle-rotate, .line-rotate, .boton-eliminar",
          )
          .forEach((el) => {
            (el as SVGElement).style.display = "none";
          });
        document
          .querySelectorAll(
            ".controles-texto, .boton-eliminar-texto, .boton-rotar-texto, .boton-editar-texto",
          )
          .forEach((el) => {
            (el as HTMLElement).style.display = "none";
          });
        elementoSeleccionado = null;
        modoInteraccion = null;
      }
    });

    btnGuardar?.addEventListener("click", async () => {
      try {
        // Ocultar todos los controles antes de guardar
        document
          .querySelectorAll(
            ".borde-seleccion, .handle-resize, .handle-rotate, .line-rotate, .boton-eliminar",
          )
          .forEach((el) => {
            (el as SVGElement).style.display = "none";
          });
        document
          .querySelectorAll(
            ".controles-texto, .boton-eliminar-texto, .boton-rotar-texto, .boton-editar-texto",
          )
          .forEach((el) => {
            (el as HTMLElement).style.display = "none";
          });

        // Esperar un momento para que se oculten los controles
        await new Promise((resolve) => setTimeout(resolve, 100));

        const cfg = modelosConfig[estadoDiseno.modelo];
        const svgFrontal = document.getElementById(cfg.frenteId);
        const svgTrasero = document.getElementById(cfg.espaldaId);

        if (!svgFrontal || !svgTrasero) {
          alert("Error: No se encontraron los SVG");
          return;
        }

        const canvas = document.createElement("canvas");
        canvas.width = 800;
        canvas.height = 400;
        const ctx = canvas.getContext("2d");
        if (!ctx) return;

        // Funci√≥n auxiliar para convertir im√°genes externas a Base64 dentro del SVG
        async function embedImages(svgElement: HTMLElement) {
          const clone = svgElement.cloneNode(true) as HTMLElement;
          const images = clone.querySelectorAll("image");

          await Promise.all(
            Array.from(images).map(async (img) => {
              const href = img.getAttribute("href");
              if (href && !href.startsWith("data:")) {
                try {
                  const response = await fetch(href);
                  const blob = await response.blob();
                  return new Promise<void>((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                      img.setAttribute("href", reader.result as string);
                      resolve();
                    };
                    reader.readAsDataURL(blob);
                  });
                } catch (e) {
                  console.warn("No se pudo cargar la imagen:", href, e);
                }
              }
            }),
          );
          return clone;
        }

        const [cloneFr, cloneBk] = await Promise.all([
          embedImages(svgFrontal),
          embedImages(svgTrasero),
        ]);

        // Serializar SVGs con overlays incluidos e im√°genes incrustadas
        const dataFr = new XMLSerializer().serializeToString(cloneFr);
        const dataBk = new XMLSerializer().serializeToString(cloneBk);

        const imgFr = new Image();
        const imgBk = new Image();

        imgFr.src =
          "data:image/svg+xml;base64," +
          btoa(unescape(encodeURIComponent(dataFr)));
        imgBk.src =
          "data:image/svg+xml;base64," +
          btoa(unescape(encodeURIComponent(dataBk)));

        await Promise.all([
          new Promise((r) => (imgFr.onload = r)),
          new Promise((r) => (imgBk.onload = r)),
        ]);

        // Dibujar fondo y SVGs
        ctx.fillStyle = "#f9fafb";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(imgFr, 0, 0, 400, 400);
        ctx.drawImage(imgBk, 400, 0, 400, 400);

        const link = document.createElement("a");
        link.download = `poleron-generacion-urbano-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
      } catch (e) {
        console.error(e);
        alert("Error al guardar: " + e);
      }
    });

    btnWhatsApp?.addEventListener("click", () => {
      const cfg = modelosConfig[estadoDiseno.modelo];

      // Construir mensaje detallado con toda la informaci√≥n del dise√±o
      let mensaje = `*HOLA! DISE√ëE MI POLERON EN GENERACION URBANA*\n\n`;
      mensaje += `*MODELO:* ${cfg.nombre}\n\n`;

      // Colores por parte
      mensaje += `*COLORES POR PARTE:*\n`;
      cfg.partes.forEach((parte) => {
        const nombreParte = nombresPartes[parte] || parte;
        const colorHex = estadoDiseno.colores[parte] || "Sin definir";
        const nombreColor =
          colorHex !== "Sin definir"
            ? obtenerNombreColor(colorHex)
            : "Sin definir";
        mensaje += `- ${nombreParte}: ${nombreColor}\n`;
      });

      // Textos
      mensaje += `\n*TEXTOS:* ${estadoDiseno.textos.length}\n`;
      if (estadoDiseno.textos.length > 0) {
        estadoDiseno.textos.forEach((txt, idx) => {
          mensaje += `${idx + 1}. "${txt.texto}"\n`;
          mensaje += `   - Color: ${txt.color}\n`;
          mensaje += `   - Tama√±o: ${txt.size}px\n`;
          mensaje += `   - Posicion: (${Math.round(txt.x)}, ${Math.round(txt.y)})\n`;
          mensaje += `   - Rotacion: ${Math.round(txt.rotation)} grados\n`;
          mensaje += `   - Vista: ${txt.vista === "frontal" ? "Frente" : "Espalda"}\n`;
        });
      }

      // Im√°genes
      mensaje += `\n*IMAGENES:* ${estadoDiseno.imagenes.length}\n`;
      if (estadoDiseno.imagenes.length > 0) {
        estadoDiseno.imagenes.forEach((img, idx) => {
          mensaje += `${idx + 1}. Imagen ${idx + 1}\n`;
          mensaje += `   - Tama√±o: ${Math.round(img.width)}x${Math.round(img.height)}px\n`;
          mensaje += `   - Posicion: (${Math.round(img.x)}, ${Math.round(img.y)})\n`;
          mensaje += `   - Rotacion: ${Math.round(img.rotation)} grados\n`;
          mensaje += `   - Vista: ${img.vista === "frontal" ? "Frente" : "Espalda"}\n`;
        });
      }

      // Emojis
      const hayEmoji = estadoDiseno.textos.some((t) => contieneEmoji(t.texto));
      mensaje += `\n*CONTIENE EMOJIS:* ${hayEmoji ? "Si" : "No"}\n`;

      mensaje += `\n*Me pueden ayudar con este dise√±o?*\n`;
      mensaje += `Dise√±ado en: ${window.location.href}`;

      window.open(
        `https://wa.me/56990659619?text=${encodeURIComponent(mensaje)}`,
        "_blank",
      );
    });

    btnReset?.addEventListener("click", () => {
      if (!confirm("¬øReiniciar dise√±o?")) return;
      estadoDiseno.colores = {
        cuerpo: "#FFFFFF",
        mangas: "#FFFFFF",
        cintura: "#000000",
        pu√±os: "#000000",
        "gorro-externo": "#FFFFFF",
        "gorro-interno": "#B0B0B0", // Gris Melange
        bolsillo: "#FFFFFF",
      };
      estadoDiseno.parteActual = "cuerpo";
      estadoDiseno.modelo = "modelo-1";
      estadoDiseno.imagenes = [];
      estadoDiseno.textos = [];
      elementoSeleccionado = null;
      textoEnEdicionId = null;
      limpiarEditorTexto();
      parteSelect.value = "cuerpo";
      colorCustomInput.value = "#FFFFFF";
      document
        .querySelectorAll(".modelo-btn")
        .forEach((b) => b.classList.remove("active"));
      document
        .querySelector('[data-modelo="modelo-1"]')
        ?.classList.add("active");
      actualizarModelo("modelo-1");
      actualizarOverlays();
      if (infoParte) infoParte.textContent = "cuerpo";
    });

    function aplicarResponsive() {
      document.body.classList.toggle("mobile-simple", window.innerWidth < 640);
    }
    window.addEventListener("resize", aplicarResponsive);
    aplicarResponsive();

    // Soporte para tecla Delete/Supr
    document.addEventListener("keydown", (e) => {
      if (
        (e.key === "Delete" || e.key === "Backspace") &&
        elementoSeleccionado
      ) {
        e.preventDefault();
        if (elementoSeleccionado.tipo === "imagen") {
          estadoDiseno.imagenes = estadoDiseno.imagenes.filter(
            (i) => i.id !== elementoSeleccionado!.id,
          );
        } else if (elementoSeleccionado.tipo === "texto") {
          estadoDiseno.textos = estadoDiseno.textos.filter(
            (t) => t.id !== elementoSeleccionado!.id,
          );
        }
        elementoSeleccionado = null;
        actualizarOverlays();
      }
    });

    actualizarModelo(estadoDiseno.modelo);
    actualizarColores();

    // Funci√≥n para actualizar el indicador visual de vista activa
    function actualizarIndicadorVista() {
      const contenedorFrontal = document.getElementById("contenedorFrontal");
      const contenedorTrasero = document.getElementById("contenedorTrasero");

      if (!contenedorFrontal || !contenedorTrasero) return;

      // Obtener los divs internos (bg-gray-100)
      const divFrontal = contenedorFrontal.querySelector(".bg-gray-100");
      const divTrasero = contenedorTrasero.querySelector(".bg-gray-100");

      if (!divFrontal || !divTrasero) return;

      if (estadoDiseno.vistaActual === "frontal") {
        divFrontal.classList.remove("border-transparent");
        divFrontal.classList.add("border-blue-500");
        divTrasero.classList.remove("border-blue-500");
        divTrasero.classList.add("border-transparent");
      } else {
        divTrasero.classList.remove("border-transparent");
        divTrasero.classList.add("border-blue-500");
        divFrontal.classList.remove("border-blue-500");
        divFrontal.classList.add("border-transparent");
      }
    }

    // Event listeners para cambiar de vista al hacer clic
    const contenedorFrontal = document.getElementById("contenedorFrontal");
    const contenedorTrasero = document.getElementById("contenedorTrasero");

    if (contenedorFrontal) {
      contenedorFrontal.addEventListener("click", () => {
        estadoDiseno.vistaActual = "frontal";
        actualizarIndicadorVista();
        actualizarInfoDiseno();
      });
    }

    if (contenedorTrasero) {
      contenedorTrasero.addEventListener("click", () => {
        estadoDiseno.vistaActual = "trasera";
        actualizarIndicadorVista();
        actualizarInfoDiseno();
      });
    }

    // Inicializar el indicador visual
    actualizarIndicadorVista();

    // L√≥gica para colapsar paneles
    document.querySelectorAll(".panel-header").forEach((header) => {
      const content = header.nextElementSibling as HTMLElement;
      const icon = header.querySelector("span");

      // Inicializar el icono seg√∫n el estado inicial
      if (content && icon) {
        icon.style.transform = content.classList.contains("hidden")
          ? "rotate(-90deg)"
          : "rotate(0deg)";
      }

      header.addEventListener("click", () => {
        if (content) {
          content.classList.toggle("hidden");
          if (icon) {
            icon.style.transform = content.classList.contains("hidden")
              ? "rotate(-90deg)"
              : "rotate(0deg)";
          }
        }
      });
    });
  </script>
</BaseLayout>
